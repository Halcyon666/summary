---
id: spring-boot
title: Spring Boot
sidebar_label: Spring Boot
sidebar_position: 10
description: A bug finds in those of tasks where you need change the date by the nature.
  <br/> Firstly You should inject a prototype bean to spring context, instea
tags:
- algorithm
- computer-science
- data-structures
last_update:
  date: '2026-01-25'
  author: halcyon666
---
# Spring Boot

## Singleton Inject but need dynamic changing value

A bug finds in those of tasks where you need change the date by the nature. <br/>
Firstly You should inject a prototype bean to spring context, instead of injecting a singleton object; Secondly you need use this way.

```java
@Component
public class SingletonService {

    // 使用 ObjectFactory（也可以用 javax.inject.Provider 或 Spring 的 Provider）
    @Resource
    // highlight-next-line
    private ObjectFactory<PrototypeBean> prototypeBeanFactory;

    public void callTest() {
        PrototypeBean prototypeBean = prototypeBeanFactory.getObject();
        prototypeBean.doSomething();
    }
}
```

## 启动问题

### Springboot启动时报错 org.springframework.boot不存在

***建议采用方法二在终端中输入`mvn idea:idea`，方法一在Spring Boot 项目中，运行其他Main方法测试类的时候会重新启动SpringBoot 工程，如果你还从ApplicationContext中获取，那么将会收到报错容器已经关闭。***
[参见博客](https://blog.csdn.net/qq_35456400/article/details/107190640)

### spring boot源码运行SpringApplication时报错

Could not find artifact lifecycle-mapping:lifecycle-mapping:jar:sources:1.0.0
[参见博客 已经要付费看了！无语](https://blog.csdn.net/awecoder/article/details/101159870)

### gradle spring boot 3.0 导入报错

[无效的源发行版: 17](https://stackoverflow.com/questions/69696321/intellij-invalid-source-release-17)

确保gradle的版本JDK 17 和 JDK 的版本正确。

![image-20230728021351697](https://s2.loli.net/2023/07/28/UzsD4BnrPYSbo1T.png)

## 日志相关

### 启动控制台日志没有颜色

在spring-logback.xml中引入
```xml
<include resource="org/springframework/boot/logging/logback/base.xml"/>
<logger name="org.springframework.web" level="INFO"/>
<logger name="org.springboot.sample" level="TRACE"/>
```

### logback 修改日志打印内容

代码: extends ThrowableHandlingConverter
impl convert 方法

logback配置
```xml
<conversionRule convertionWord="someKeyMsg" convertClass="com.xxx.xxx.Xclass"/>
```


## 打包问题

### after run the packaged jar occurs this unable to find main class

方法1. 替换插件
```xml
<!--<plugin>
	<groupId>org.springframework.boot</groupId>
	<artifactId>spring-boot-maven-plugin</artifactId>
	<configuration>
		<mainClass>none</mainClass>
		<classifier>execute</classifier>
	</configuration>
	<executions>
		<execution>
			<goals>
				<goal>repackage</goal>
			</goals>
		</execution>
	</executions>
</plugin>-->
<plugin>
	<groupId>org.apache.maven.plugins</groupId>
	<artifactId>maven-source-plugin</artifactId>
	<version>3.0.1</version>
	<executions>
		<execution>
			<id>attach-sources</id>
			<goals>
				<goal>jar</goal>
			</goals>
		</execution>
	</executions>
</plugin>
```

方法2: 去掉spring-boot parent，再使用spring boot plugin 打包

---

## 获取 AOP 代理对象的真实类注解

在 Spring Boot 中，使用 `@Aspect` 等 AOP 技术后，注入的 Bean 是**代理对象**。
直接通过 `getClass().getAnnotation()` 往往无法获取到原始类上的注解（尤其是 JDK 动态代理）。

核心解决方案:使用 Spring 提供的 `AopProxyUtils` 穿透代理，获取最终的**原始业务类**。

<details>
<summary>点击查看</summary>
```java
import org.springframework.aop.framework.AopProxyUtils;
// ...
@Component
public class MyAnnotationScanner implements ApplicationRunner {

    private final ApplicationContext context;
    private final Map<String, MyAnnotation> cacheMap = new ConcurrentHashMap<>();

    public MyAnnotationScanner(ApplicationContext context) {
        this.context = context;
    }

    @Override
    public void run(ApplicationArguments args) {
        // 1. 获取所有带有特定注解的 Bean
        Map<String, Object> beans = context.getBeansWithAnnotation(MyAnnotation.class);

        beans.forEach((name, bean) -> {
            // 2. 穿透代理，获取真实的类（TargetClass）
            Class<?> targetClass = AopProxyUtils.ultimateTargetClass(bean);
            
            // 3. 提取注解信息
            MyAnnotation anno = AnnotationUtils.findAnnotation(targetClass, MyAnnotation.class);
            
            if (anno != null) {
                cacheMap.put(targetClass.getName(), anno);
            }
        });
    }
}
```
</details>


import TailProtocal from "@site/src/components/TailProtocal";

<TailProtocal />
