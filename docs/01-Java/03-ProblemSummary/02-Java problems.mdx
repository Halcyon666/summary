# Java问题汇总

## Maven相关问题

### 处理Maven远程仓库下载不到jar包问题

*先去[Maven Repository](https://mvnrepository.com/)找到对应的依赖，并下载。*

*去下载目录下执行如下命令，注意替换掉-DgroupId，-DartifactId，-Dversion，-Dfile*

```shell
mvn install:install-file -DgroupId=io.confluent -DartifactId=kafka-schema-registry-client -Dversion=4.1.0 -Dpackaging=jar  -Dfile=kafka-schema-registry-client-4.1.0.jar
```

### mvnw clean occurs Some Enforcer rules have failed

```log
Failed to execute goal org.apache.maven.plugins:maven-enforcer-plugin:1.4.1:enforce
(enforce-versions) on project SIMI: Some Enforcer rules have failed. Look above for
specific messages explaining why the rule failed. -> [Help 1]
```

[not solved! stackoverflow  website](https://stackoverflow.com/questions/45337558/failed-to-execute-goal-org-apache-maven-pluginsmaven-enforcer-plugin?newreg=4546ba2b3da24e02908324ea31452cb8)

To skip enforcer (not always working)
```bash
mvn clean install -Denforcer.skip=true
```

To continue the build if error
```bash
mvn clean install -Denforcer.fail=false
```

```bash
./mvnw clean install -DskipDistribution=true  -Denforcer.skip=true
```

---

## MyBatis相关问题

### SQL查询时 null值封装回int类型报 UncategorizedSQLException

将BO属性从int改为Integer类型

```
org.springframework.jdbc.UncategorizedSQLException: SqlMapClient operation; 
uncategorized SQLException for SQL []; SQL state [null]; error code [0];
```

### Mysql tinyint有毒

mysql 不要使用字段类型tinyint 可能你更新的1会变成49哦

[参见博客](https://www.huaweicloud.com/articles/11968406.html)

### MybatisPlus 出现 Invalid bound statement (not found) 异常

[参见文章](https://baomidou.com/pages/f84a74/#%E5%87%BA%E7%8E%B0-invalid-bound-statement-not-found-%E5%BC%82%E5%B8%B8)

---

## IDEA使用相关问题

### idea terminal 中文乱码问题

[参考文章](https://blog.csdn.net/xgw1010/article/details/108583796)

```bash
# solve idea terminal Chinese garbled
export LANG="zh_CN.UTF-8"
export LC_ALL="zh_CN.UTF-8"
```

---

## 其他问题

### 动态数据源问题

如果所用的操作有事务，则需要在Dao层之前，对数据源进行设置，在Dao或者Mybatis-plus中的带dao的service都会切换数据源失效。

### boolean改为Boolean可能遇到的问题

代码优化时，原始类型改成包装类型时，如果是Spring 注入的方式，注意默认值会有变化，boolean默认值为false，包装类为null，可能会造成空指针异常。

boolean 改为Boolean值，某些场景（netty 不响应请求)会有问题。

处理：给Boolean类赋值false

### jackson序列化问题

错误信息:
```java
Java 8 date/time type java.time.LocalDateTime not supported by default:
add Module "com.fasterxml.jackson.datatype:jackson-datatype-jsr310" to enable
handling (through reference chain: java.util.ArrayList[0]->xxx.xxx.xxx.xxx.XxxxPo["updatetime"])
```

先排查是哪里报的

1. 如果是可扩展Spring Boot的：直接扩展`ObjectMapper`
```java
@Configuration
public class JacksonConfig implements WebMvcConfigurer {
    @Override
    public void extendMessageConverters(final List<HttpMessageConverter<?>> converters) {
        MappingJackson2HttpMessageConverter messageConverter = new MappingJackson2HttpMessageConverter();
        ObjectMapper objectMapper = new ObjectMapper();
        objectMapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);
        objectMapper.disable(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS);
        objectMapper.registerModule(new JavaTimeModule());
        messageConverter.setObjectMapper(objectMapper);
        converters.add(0, messageConverter);
    }
}
```

2. 如果无法扩展，考虑跳过`Bean`序列化步骤，比如用其实转化Bean为Map的方法
3. 实在没有办法，改用`Fastjson`或者`Gjson`

## 数据库连接池配置问题

使用Druid 连接池时, 配置参数 `validationInterval`必须小于 `timeBetweenEvictionRunMillis`, 保证数据库连接一直是可用的。

## API接口规范
- 查询数据量、
- 入参参数检查、
- 响应报文中大整数，浮点数字段使用字符串类型
- 入参类型不为基本类型

import TailProtocal from "@site/src/components/TailProtocal";

<TailProtocal />
