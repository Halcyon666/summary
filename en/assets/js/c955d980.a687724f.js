"use strict";(self.webpackChunksummary=self.webpackChunksummary||[]).push([["525"],{50392(e,t,n){n.r(t),n.d(t,{metadata:()=>r,default:()=>p,frontMatter:()=>s,contentTitle:()=>c,toc:()=>i,assets:()=>l});var r=JSON.parse('{"id":"background/Java/Concurrent-JVM/java-concurrent-cases","title":"Java Concurrent Programming","description":"Using Executor and CompletableFuture to concurrent execute the Many Queries. Below is commit changes.","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/background/Java/Concurrent-JVM/Java Concurrent Cases.mdx","sourceDirName":"background/Java/Concurrent-JVM","slug":"/background/Java/Concurrent-JVM/java-concurrent-cases","permalink":"/en/background/Java/Concurrent-JVM/java-concurrent-cases","draft":false,"unlisted":false,"editUrl":"https://github.com/Halcyon666/summary/edit/main/docs/background/Java/Concurrent-JVM/Java Concurrent Cases.mdx","tags":[{"inline":true,"label":"case-study","permalink":"/en/tags/case-study"},{"inline":true,"label":"frontend","permalink":"/en/tags/frontend"}],"version":"current","lastUpdatedBy":"halcyon666","lastUpdatedAt":1769299200000,"sidebarPosition":10,"frontMatter":{"id":"java-concurrent-cases","title":"Java Concurrent Programming","sidebar_label":"Java Concurrent Programming","sidebar_position":10,"description":"Using Executor and CompletableFuture to concurrent execute the Many Queries. Below is commit changes.","tags":["case-study","frontend"],"last_update":{"date":"2026-01-25","author":"halcyon666"},"sources":["spring-core"]},"sidebar":"tutorialSidebar","previous":{"title":"JMM Related Content","permalink":"/en/background/Java/Concurrent-JVM/jmm"},"next":{"title":"Final Field Memory Knowledge","permalink":"/en/background/Java/Concurrent-JVM/final-memory-domain"}}'),a=n(62615),o=n(77545),u=n(4040);let s={id:"java-concurrent-cases",title:"Java Concurrent Programming",sidebar_label:"Java Concurrent Programming",sidebar_position:10,description:"Using Executor and CompletableFuture to concurrent execute the Many Queries. Below is commit changes.",tags:["case-study","frontend"],last_update:{date:"2026-01-25",author:"halcyon666"},sources:["spring-core"]},c="Java Concurrent Programming",l={},i=[{value:"Executor Concurrent Task Execution",id:"executor-concurrent-task-execution",level:2}];function m(e){let t={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,o.R)(),...e.components},{Details:n}=t;return n||function(e,t){throw Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.header,{children:(0,a.jsx)(t.h1,{id:"java-concurrent-programming",children:"Java Concurrent Programming"})}),"\n",(0,a.jsx)(t.h2,{id:"executor-concurrent-task-execution",children:"Executor Concurrent Task Execution"}),"\n",(0,a.jsx)(t.p,{children:"Using Executor and CompletableFuture to concurrent execute the Many Queries. Below is commit changes."}),"\n",(0,a.jsxs)(n,{children:[(0,a.jsx)("summary",{children:"Java Concurrent Programming Case: Task Failure Fail-Fast Cancels Other Tasks"}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-java",metastring:"setLineNumbers",children:'package com.whalefall541.cases.concurrentqry.jobversion;\n\nimport lombok.extern.slf4j.Slf4j;\n\nimport java.util.List;\nimport java.util.concurrent.*;\nimport java.util.concurrent.atomic.AtomicBoolean;\nimport java.util.function.Function;\nimport java.util.stream.Collectors;\n\n@SuppressWarnings("all")\n@Slf4j\npublic class JobFailFastAsyncExecutor implements AutoCloseable {\n\n    private final ExecutorService executor;\n\n    public JobFailFastAsyncExecutor(int threadCount, String jobName) {\n        this.executor = Executors.newFixedThreadPool(threadCount, r -> {\n            Thread thread = new Thread(r);\n            thread.setName(String.format("%s-%s", jobName, thread.getName()));\n            return thread;\n        });\n    }\n\n    /**\n     * Execute a group of asynchronous tasks, once any task fails, immediately cancel all tasks and propagate exception <br/>\n     * Truly strict "fail-fast + minimal log"\n     *\n     * @param inputs       Input parameter list\n     * @param taskFunction Task processing function, input P return R\n     * @return An asynchronous CompletableFuture, returns result list on success, throws first exception on failure\n     */\n    public <P, R> CompletableFuture<List<R>> executeFailFast(List<P> inputs, Function<P, R> taskFunction) {\n        List<CompletableFuture<R>> futures = inputs.stream()\n                .map(input -> CompletableFuture.supplyAsync(\n                        // Asynchronous thread (from thread pool) executes logic below\n                        () -> taskFunction.apply(input), executor))\n                .collect(Collectors.toList());\n        CompletableFuture<List<R>> resultFuture = new CompletableFuture<>();\n        CommonTaskSupport.registerFailFastHandlers(futures, resultFuture);\n        CommonTaskSupport.collectAllResults(futures, resultFuture);\n        return resultFuture;\n    }\n\n    static class CommonTaskSupport {\n        private CommonTaskSupport() {\n        }\n\n        public static <R> void registerFailFastHandlers(List<CompletableFuture<R>> futures,\n                                                        CompletableFuture<List<R>> resultFuture) {\n            AtomicBoolean failFastTriggered = new AtomicBoolean(false);\n            futures.forEach(future -> future.whenComplete(\n                    // Triggered after asynchronous threads below complete\n                    (r, ex) -> {\n                        if (ex != null && failFastTriggered.compareAndSet(false, true)) {\n                            Throwable actual = unwrap(ex);\n                            logIfNeeded(actual);\n                            resultFuture.completeExceptionally(actual);\n                            futures.forEach(f -> {\n                                boolean cancelled = f.cancel(true);\n                                log.debug("Try to cancel task {}: {}", f, cancelled ? "Success" : "Failed");\n                            });\n                        }\n                    }));\n        }\n\n        private static Throwable unwrap(Throwable ex) {\n            if (ex instanceof CompletionException || ex instanceof ExecutionException) {\n                return ex.getCause();\n            }\n            return ex;\n        }\n\n        /**\n         * Gracefully shutdown thread pool\n         *\n         * @param executor Thread pool\n         */\n        public static void shutdownGracefully(ExecutorService executor) {\n            executor.shutdown();\n            try {\n                if (!executor.awaitTermination(1, TimeUnit.MINUTES)) {\n                    executor.shutdownNow();\n                }\n            } catch (InterruptedException e) {\n                executor.shutdownNow();\n                Thread.currentThread().interrupt();\n            }\n        }\n\n        private static void logIfNeeded(Throwable actual) {\n            if (!(actual instanceof CancellationException)) {\n                log.warn("Task failed, start fail-fast to cancel other tasks: {} - [{}]",\n                        actual != null ? actual.getMessage() : "null",\n                        actual != null ? actual.getClass().getSimpleName() : "null");\n            }\n        }\n\n        public static <R> void collectAllResults(List<CompletableFuture<R>> futures,\n                                                 CompletableFuture<List<R>> resultFuture) {\n            CompletableFuture\n                    .allOf(futures.toArray(new CompletableFuture[0]))\n                    .whenComplete((v, ex) -> {\n                        if (!resultFuture.isDone()) {\n                            try {\n                                List<R> results = futures.stream()\n                                        .map(CompletableFuture::join)\n                                        .collect(Collectors.toList());\n                                resultFuture.complete(results);\n                            } catch (CompletionException e) {\n                                resultFuture.completeExceptionally(e.getCause());\n                            }\n                        }\n                    });\n        }\n    }\n\n\n    @Override\n    public void close() {\n        CommonTaskSupport.shutdownGracefully(executor);\n    }\n\n}\n\n'})})]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.a,{href:"https://github.com/Halcyon666/mybatis-plus/tree/purebranch/src/main/java/com/whalefall541/cases/concurrentqry",children:"Detailed code commit record"})}),"\n","\n",(0,a.jsx)(u.A,{})]})}function p(e={}){let{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(m,{...e})}):m(e)}}}]);