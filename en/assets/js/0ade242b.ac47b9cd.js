"use strict";(self.webpackChunksummary=self.webpackChunksummary||[]).push([["5818"],{42792(e,t,n){n.r(t),n.d(t,{metadata:()=>r,default:()=>h,frontMatter:()=>s,contentTitle:()=>a,toc:()=>l,assets:()=>d});var r=JSON.parse('{"id":"background/Java/Spring/AOP/advice","title":"Advice in Spring AOP","description":"Please refer to [spring-framework](https://github.com/Halcyon666/spring-framework-modified/tree/main/spring-test) for code related to this article (from official source spring-test module)","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/background/Java/Spring/AOP/advice.mdx","sourceDirName":"background/Java/Spring/AOP","slug":"/background/Java/Spring/AOP/advice","permalink":"/en/background/Java/Spring/AOP/advice","draft":false,"unlisted":false,"editUrl":"https://github.com/Halcyon666/summary/edit/main/docs/background/Java/Spring/AOP/advice.mdx","tags":[{"inline":true,"label":"algorithm","permalink":"/en/tags/algorithm"},{"inline":true,"label":"computer-science","permalink":"/en/tags/computer-science"},{"inline":true,"label":"data-structures","permalink":"/en/tags/data-structures"}],"version":"current","lastUpdatedBy":"halcyon666","lastUpdatedAt":1769299200000,"sidebarPosition":10,"frontMatter":{"id":"advice","title":"Advice in Spring AOP","sidebar_label":"Advice in Spring AOP","sidebar_position":10,"description":"Please refer to [spring-framework](https://github.com/Halcyon666/spring-framework-modified/tree/main/spring-test) for code related to this article (from official source spring-test module)","tags":["algorithm","computer-science","data-structures"],"last_update":{"date":"2026-01-25","author":"halcyon666"},"sources":["spring-core"]},"sidebar":"tutorialSidebar","previous":{"title":"Usage of AspectJ style AOP","permalink":"/en/background/Java/Spring/AOP/AspectJ/full-aspectj-temp"},"next":{"title":"Aspect in Spring AOP","permalink":"/en/background/Java/Spring/AOP/aspect"}}'),i=n(62615),o=n(77545),c=n(4040);let s={id:"advice",title:"Advice in Spring AOP",sidebar_label:"Advice in Spring AOP",sidebar_position:10,description:"Please refer to [spring-framework](https://github.com/Halcyon666/spring-framework-modified/tree/main/spring-test) for code related to this article (from official source spring-test module)",tags:["algorithm","computer-science","data-structures"],last_update:{date:"2026-01-25",author:"halcyon666"},sources:["spring-core"]},a,d={},l=[{value:"Introduction",id:"introduction",level:2},{value:"per-class",id:"per-class",level:3},{value:"BeforeAdvice",id:"beforeadvice",level:4},{value:"ThrowsAdvice",id:"throwsadvice",level:4},{value:"AfterReturningAdvice",id:"afterreturningadvice",level:4},{value:"Around Advice",id:"around-advice",level:4},{value:"per-instance",id:"per-instance",level:3},{value:"DelegatingIntroductionInterceptor",id:"delegatingintroductioninterceptor",level:4},{value:"DelegatePerTargetObjectIntroductionInterceptor",id:"delegatepertargetobjectintroductioninterceptor",level:4},{value:"Extending DelegatingIntroductionInterceptor",id:"extending-delegatingintroductioninterceptor",level:4}];function p(e){let t={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components},{Details:n}=t;return n||function(e,t){throw Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(t.p,{children:["Please refer to ",(0,i.jsx)(t.a,{href:"https://github.com/Halcyon666/spring-framework-modified/tree/main/spring-test",children:"spring-framework"})," under ",(0,i.jsx)(t.code,{children:"org.springframework.mylearntest"})," package for code related to this article (from ",(0,i.jsx)(t.a,{href:"https://github.com/spring-projects/spring-framework.git",title:"official source",children:"official source"})," spring-test module)."]}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Before Advice"}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"After Advice"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.blockquote,{children:["\n",(0,i.jsx)(t.p,{children:"After returning"}),"\n",(0,i.jsx)(t.p,{children:"After throwing"}),"\n",(0,i.jsx)(t.p,{children:"After Advice(finally)"}),"\n"]}),"\n",(0,i.jsxs)(t.ol,{start:"3",children:["\n",(0,i.jsx)(t.li,{children:"After Around"}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{src:"https://s2.loli.net/2023/07/15/jhWAx2tqe6EzoNU.png",alt:""})}),"\n",(0,i.jsx)(t.h2,{id:"introduction",children:"Introduction"}),"\n",(0,i.jsx)(t.p,{children:"It is called Inter-Type Declaration in AspectJ, and Mix-in in JBoss AOP, both refer to the same type of Advice. Unlike other types of Advice mentioned before, Introduction is not distinguished by the execution timing at Joinpoint based on cross-cutting logic, but is distinguished from other Advice types based on the functions it can complete."}),"\n",(0,i.jsx)(t.p,{children:"AspectJ uses static weaving, so when the object is used, the Introduction logic has already been woven during compilation. Theoretically, Introduction type Advice provided by AspectJ has the best performance among AOP implementations on the existing Java platform; while AOP implementations using dynamic weaving like JBoss AOP or Spring AOP have slightly inferior performance for Introduction."}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{src:"https://s2.loli.net/2023/07/15/xVSYeWcNrbk3aqg.png",alt:""})}),"\n",(0,i.jsxs)(t.p,{children:["In Spring, Advice can be divided into two main categories based on whether its own instance can be shared among all instances of the target object class: ",(0,i.jsx)("font",{style:{color:"green"},children:"per-class type Advice and per-instance type Advice"}),"."]}),"\n",(0,i.jsx)(t.h3,{id:"per-class",children:"per-class"}),"\n",(0,i.jsx)(t.p,{children:"per-class Advice means that the instance of this type of Advice can be shared among all instances of the target object class. Usually, this type of Advice only provides method interception functions and does not save any state or add new features to the target object class."}),"\n",(0,i.jsx)(t.h4,{id:"beforeadvice",children:"BeforeAdvice"}),"\n",(0,i.jsxs)(n,{children:[(0,i.jsx)("summary",{children:"ResourceSetupBeforeAdvice"}),(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-java",children:"package org.springframework.mylearntest.aop.advice;\n\nimport org.apache.commons.io.FileUtils;\nimport org.springframework.aop.MethodBeforeAdvice;\nimport org.springframework.core.io.Resource;\n\nimport java.lang.reflect.Method;\n\npublic class ResourceSetupBeforeAdvice implements MethodBeforeAdvice {\n    private Resource resource;\n\n    public ResourceSetupBeforeAdvice(Resource resource) {\n        this.resource = resource;\n    }\n\n    @Override\n    public void before(Method method, Object[] args, Object target) throws Throwable {\n        if (!resource.exists()) {\n            FileUtils.forceMkdir(resource.getFile());\n        }\n    }\n}\n"})})]}),"\n",(0,i.jsx)(t.h4,{id:"throwsadvice",children:"ThrowsAdvice"}),"\n",(0,i.jsxs)(n,{children:[(0,i.jsx)("summary",{children:"ExceptionBarrierThrowsAdvice"}),(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-java",children:"package org.springframework.mylearntest.aop.advice;\n\nimport org.omg.CORBA.portable.ApplicationException;\nimport org.springframework.aop.ThrowsAdvice;\n\nimport java.lang.reflect.Method;\n\npublic class ExceptionBarrierThrowsAdvice implements ThrowsAdvice {\n    public void afterThrowing(Throwable t) {\n        // Normal exception handling\n    }\n\n    public void afterThrowing(RuntimeException t) {\n        // Runtime exception handling\n    }\n\n    public void afterThrowing(Method m, Object[] args, Object target, ApplicationException e) {\n        // Handle application-generated exceptions\n    }\n}\n"})})]}),"\n",(0,i.jsx)(t.h4,{id:"afterreturningadvice",children:"AfterReturningAdvice"}),"\n",(0,i.jsx)(t.p,{children:"This Advice can access the return value, method, method arguments, and the target object of the current Joinpoint, but cannot change the return value. You can use Around Advice to change the return value."}),"\n",(0,i.jsx)(t.h4,{id:"around-advice",children:"Around Advice"}),"\n",(0,i.jsxs)(t.p,{children:["Spring does not define Around Advice, but directly uses the standard interface of AOP Alliance, implementing ",(0,i.jsx)(t.code,{children:"MethodInterceptor"})," is enough."]}),"\n",(0,i.jsx)(t.h3,{id:"per-instance",children:"per-instance"}),"\n",(0,i.jsx)(t.p,{children:"per-instance type Advice will not be shared among all object instances of the target class, but will save their respective states and related logic for different instance objects. In Spring, Introduction is the only per-instance type Advice."}),"\n",(0,i.jsx)(t.p,{children:"Introduction can add new attributes and behaviors to the target class without changing the target class definition."}),"\n",(0,i.jsxs)(t.p,{children:["In Spring, to add new attributes and behaviors to the target object, corresponding interfaces and implementations must be declared. Then, through a specific interceptor, the new interface definition and the logic in the implementation class are attached to the target object. After that, the target object has new states and behaviors. This specific interceptor is ",(0,i.jsx)(t.code,{children:"org.springframework.aop.IntroductionInterceptor"}),"."]}),"\n",(0,i.jsxs)(t.p,{children:["Introduction inherits ",(0,i.jsx)(t.code,{children:"MethodInterceptor"})," and ",(0,i.jsx)(t.code,{children:"DynamicIntroductionAdvice"}),". Through ",(0,i.jsx)(t.code,{children:"DynamicIntroductionAdvice"}),", we can define for which interface classes the current ",(0,i.jsx)(t.code,{children:"IntroductionInterceptor"})," provides corresponding interception functions. Through ",(0,i.jsx)(t.code,{children:"MethodInterceptor"}),", ",(0,i.jsx)(t.code,{children:"IntroductionInterceptor"})," can handle method calls on the newly added interfaces. Usually, for ",(0,i.jsx)(t.code,{children:"IntroductionInterceptor"}),", if it is a method call on a newly added interface, there is no need to call the ",(0,i.jsx)(t.code,{children:"proceed()"})," method of ",(0,i.jsx)(t.code,{children:"MethodInterceptor"}),". The currently intercepted method is actually the only method to be executed in the entire call chain."]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{src:"https://s2.loli.net/2023/07/15/64GVq9mJlEk7wMc.png",alt:"Introduction Class Diagram",title:"Introduction Class Diagram"})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["Introduction type Advice has two branches: dynamic branch headed by ",(0,i.jsx)(t.code,{children:"DynamicIntroductionAdvice"})," (non-shared) and static branch headed by ",(0,i.jsx)(t.code,{children:"IntroductionInfo"})," (shared)."]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.code,{children:"DynamicIntroductionAdvice"})," does not need to pre-set the target interface type; while ",(0,i.jsx)(t.code,{children:"IntroductionInfo"})," is completely opposite, the implementation class must return the pre-determined target interface type."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n,{children:[(0,i.jsx)("summary",{children:"IntroductionInfo"}),(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-java",children:"public interface IntroductionInfo {\n    Class[] getInterfaces();\n}\n"})})]}),"\n",(0,i.jsxs)(t.p,{children:["If you need to intercept the target object and add Introduction logic, you can use two existing implementation classes: ",(0,i.jsx)(t.code,{children:"DelegatingIntroductionInterceptor"}),", ",(0,i.jsx)(t.code,{children:"DelegatePerTargetObjectIntroductionInterceptor"}),"."]}),"\n",(0,i.jsx)(t.h4,{id:"delegatingintroductioninterceptor",children:"DelegatingIntroductionInterceptor"}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.code,{children:"DelegatingIntroductionInterceptor"})," will not implement the new logic behavior to be added to the target object itself, but delegate it to other implementation classes."]}),"\n",(0,i.jsxs)(t.p,{children:["Use ",(0,i.jsx)(t.code,{children:"DelegatingIntroductionInterceptor"})," to enhance Developer. Interface omitted."]}),"\n",(0,i.jsxs)(n,{children:[(0,i.jsx)("summary",{children:"Developer"}),(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-java",children:'package org.springframework.mylearntest.aop.advice.perinstance.delegatingIntroductionInterceptor;\n\npublic class Developer implements IDeveloper{\n    @Override\n    public void developSoftware() {\n        System.out.println(" do some developing ...");\n    }\n}\n'})})]}),"\n",(0,i.jsx)(t.p,{children:"Define interface for new state and behavior. To add enhanced functions to the implementation class, first we need to declare the required functions in the form of interface definition."}),"\n",(0,i.jsxs)(n,{children:[(0,i.jsx)("summary",{children:"ITester"}),(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-java",children:"package org.springframework.mylearntest.aop.advice.perinstance.delegatingIntroductionInterceptor;\n\npublic interface ITester {\n    boolean isBusyAsTester();\n    void testSoftware();\n}\n"})})]}),"\n",(0,i.jsx)(t.p,{children:"Provide implementation class for the new interface. The interface implementation class gives the concrete logic to be added to the target object. When the target object wants to exercise the new function, it will seek help through this implementation class."}),"\n",(0,i.jsxs)(n,{children:[(0,i.jsx)("summary",{children:"Tester"}),(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-java",children:'package org.springframework.mylearntest.aop.advice.perinstance.delegatingIntroductionInterceptor;\n\npublic class Tester implements ITester{\n    private  boolean busyAsTester;\n\n    public void setBusyAsTester(boolean busyAsTester) {\n        this.busyAsTester = busyAsTester;\n    }\n\n    @Override\n    public boolean isBusyAsTester() {\n        return busyAsTester;\n    }\n\n    @Override\n    public void testSoftware() {\n        System.out.println("do some developing and test ...");\n    }\n}\n'})})]}),"\n",(0,i.jsxs)(t.p,{children:["Perform Introduction interception via ",(0,i.jsx)(t.code,{children:"DelegatingIntroductionInterceptor"}),". With the interface of newly added functions and corresponding implementation class, using ",(0,i.jsx)(t.code,{children:"DelegatingIntroductionInterceptor"}),", we can delegate specific Introduction interception to concrete implementation class to complete."]}),"\n",(0,i.jsxs)(n,{children:[(0,i.jsx)("summary",{children:"How to weave"}),(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-java",children:"ITester delegator = new Tester();\nDelegatingIntroductionInterceptor interceptor = new DelegatingIntroductionInterceptor(delegator);\n\n// Weaver\nITester tester = (ITester)weaver.weave(developer).with(interceptor).getProxy();\ntester.testSoftware();\n"})})]}),"\n",(0,i.jsxs)(t.p,{children:["Although ",(0,i.jsx)(t.code,{children:"DelegatingIntroductionInterceptor"})," is an implementation of Introduction type Advice, its implementation fundamentally does not fulfill the promise of Introduction being per-instance type. actually ",(0,i.jsx)(t.code,{children:"DelegatingIntroductionInterceptor"}),' will use the same "delegate" interface instance it holds, shared by all instances of the same target class. If we strictly want to achieve the effect of Introduction type Advice, we should use ',(0,i.jsx)(t.code,{children:"DelegatePerTargetObjectIntroductionInterceptor"}),"."]}),"\n",(0,i.jsx)(t.h4,{id:"delegatepertargetobjectintroductioninterceptor",children:"DelegatePerTargetObjectIntroductionInterceptor"}),"\n",(0,i.jsxs)(t.p,{children:["Unlike ",(0,i.jsx)(t.code,{children:"DelegatingIntroductionInterceptor"}),", ",(0,i.jsx)(t.code,{children:"DelegatePerTargetObjectIntroductionInterceptor"})," will internally hold a mapping relationship between target object and corresponding Introduction logic implementation class. When new defined interface method on each object is called, ",(0,i.jsx)(t.code,{children:"DelegatePerTargetObjectIntroductionInterceptor"})," will intercept these calls, then use target object instance as key to get Introduction implementation instance corresponding to current target object instance from the mapping relationship it holds."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-java",children:"DelegatePerTargetObjectIntroductionInterceptor interceptor1 =\n                new DelegatePerTargetObjectIntroductionInterceptor(Tester.class,ITester.class);\n"})}),"\n",(0,i.jsx)(t.h4,{id:"extending-delegatingintroductioninterceptor",children:"Extending DelegatingIntroductionInterceptor"}),"\n",(0,i.jsxs)(n,{children:[(0,i.jsx)("summary",{children:"TesterFeatureIntroductionInterceptor"}),(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-java",children:'package org.springframework.mylearntest.aop.advice.perinstance;\n\nimport org.aopalliance.intercept.MethodInvocation;\nimport org.apache.commons.lang3.StringUtils;\nimport org.springframework.aop.support.DelegatingIntroductionInterceptor;\n\npublic class TesterFeatureIntroductionInterceptor extends DelegatingIntroductionInterceptor implements ITester {\n\n    public static final long serialVersionUID = -3387097489523045796L;\n    private boolean busyAsTester;\n\n    @Override\n    public Object invoke(MethodInvocation mi) throws Throwable {\n        if (isBusyAsTester() && StringUtils.contains(mi.getMethod().getName(), "developSoftware")) {\n            throw new RuntimeException("I\'am so tired");\n        }\n        return super.invoke(mi);\n    }\n\n    @Override\n    public boolean isBusyAsTester() {\n        return busyAsTester;\n    }\n\n    public void setBusyAsTester(boolean busyAsTester) {\n        this.busyAsTester = busyAsTester;\n    }\n\n    @Override\n    public void testSoftware() {\n        System.out.println("I will ensure the quality");\n    }\n}\n'})})]}),"\n","\n",(0,i.jsx)(c.A,{})]})}function h(e={}){let{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}}}]);