"use strict";(self.webpackChunksummary=self.webpackChunksummary||[]).push([["3057"],{36(e,t,n){n.r(t),n.d(t,{metadata:()=>s,default:()=>u,frontMatter:()=>l,contentTitle:()=>o,toc:()=>c,assets:()=>d});var s=JSON.parse('{"id":"background/Java/JavaBase/netty","title":"netty ","description":"!20250922233019 !20250922233035","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/background/Java/JavaBase/netty.mdx","sourceDirName":"background/Java/JavaBase","slug":"/background/Java/JavaBase/netty","permalink":"/en/background/Java/JavaBase/netty","draft":false,"unlisted":false,"editUrl":"https://github.com/Halcyon666/summary/edit/main/docs/background/Java/JavaBase/netty.mdx","tags":[{"inline":true,"label":"algorithm","permalink":"/en/tags/algorithm"},{"inline":true,"label":"computer-science","permalink":"/en/tags/computer-science"},{"inline":true,"label":"data-structures","permalink":"/en/tags/data-structures"}],"version":"current","lastUpdatedBy":"halcyon666","lastUpdatedAt":1769299200000,"sidebarPosition":10,"frontMatter":{"id":"netty","title":"netty ","sidebar_label":"netty","sidebar_position":10,"description":"!20250922233019 !20250922233035","tags":["algorithm","computer-science","data-structures"],"last_update":{"date":"2026-01-25","author":"halcyon666"},"sources":["spring-core"]},"sidebar":"tutorialSidebar","previous":{"title":"lambda Usage","permalink":"/en/background/Java/JavaBase/lambda"},"next":{"title":"Jaeger Trace MDC","permalink":"/en/background/Java/JavaBase/trace"}}'),a=n(62615),i=n(77545),r=n(4040);let l={id:"netty",title:"netty ",sidebar_label:"netty",sidebar_position:10,description:"!20250922233019 !20250922233035",tags:["algorithm","computer-science","data-structures"],last_update:{date:"2026-01-25",author:"halcyon666"},sources:["spring-core"]},o="netty",d={},c=[{value:"Source Code Analysis: Why set newCtx&#39;s prev and next first, then add it to the linked list?",id:"source-code-analysis-why-set-newctxs-prev-and-next-first-then-add-it-to-the-linked-list",level:2},{value:"Netty Response Packet, Sending Location Issue",id:"netty-response-packet-sending-location-issue",level:2},{value:"Java Property Type Impact on Netty",id:"java-property-type-impact-on-netty",level:2}];function h(e){let t={admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.header,{children:(0,a.jsx)(t.h1,{id:"netty",children:"netty"})}),"\n",(0,a.jsx)(t.h2,{id:"source-code-analysis-why-set-newctxs-prev-and-next-first-then-add-it-to-the-linked-list",children:"Source Code Analysis: Why set newCtx's prev and next first, then add it to the linked list?"}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{src:"https://s2.loli.net/2025/09/22/NmiBwZOqyFnj3KQ.png",alt:"20250922233019"})}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{src:"https://s2.loli.net/2025/09/22/bi6RxrGKVFOldJT.png",alt:"20250922233035"})}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.code,{children:"io.netty.channel.DefaultChannelPipeline#addLast0"})}),"\n",(0,a.jsxs)(t.p,{children:["You're ",(0,a.jsx)(t.strong,{children:"modifying the linked list pointers"})," to include ",(0,a.jsx)(t.code,{children:"newCtx"})," ",(0,a.jsx)(t.strong,{children:"before"})," fully initializing its ",(0,a.jsx)(t.code,{children:"prev"})," and ",(0,a.jsx)(t.code,{children:"next"}),". ",(0,a.jsx)("br",{}),"\nIf anything (like another thread or debugging breakpoint) tries to traverse the list at this point \u2014 ",(0,a.jsx)(t.code,{children:"newCtx"})," is in the chain,\nbut not fully initialized yet. That could lead to nulls or broken state during traversal."]}),"\n",(0,a.jsxs)(t.p,{children:["While ",(0,a.jsx)(t.strong,{children:"your order may work in some cases"}),", it is ",(0,a.jsx)(t.strong,{children:"unsafe and not recommended"}),"."]}),"\n",(0,a.jsxs)(t.admonition,{type:"warning",children:[(0,a.jsx)(t.p,{children:"\u2757 The safe pattern is always:"}),(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:(0,a.jsx)(t.em,{children:(0,a.jsx)(t.strong,{children:"Initialize the new node's pointers"})})}),"\n",(0,a.jsx)(t.li,{children:(0,a.jsx)(t.em,{children:(0,a.jsx)(t.strong,{children:"Then hook it into the list"})})}),"\n"]})]}),"\n",(0,a.jsx)(t.h2,{id:"netty-response-packet-sending-location-issue",children:"Netty Response Packet, Sending Location Issue"}),"\n",(0,a.jsxs)(t.p,{children:["Even if a is just a sequence number (Sequence ID / Trace ID), it plays a ",(0,a.jsx)(t.strong,{children:'"bridge" key role in asynchronous communication (such as Netty). If it is missing or empty, the most direct consequence is "request and response cannot be paired"'}),', thus leading to the "direction change" you see.\nCombined with your description (the packet that should have been sent to Client was sent to other place), the root cause is highly likely: response packet was misjudged as a new request.\nThe following is detailed logical deduction:\nCore reason: Response lost "way home"\nIn Netty asynchronous non-blocking model, after server receives request, it usually does not wait for business processing to complete in place, but forwards request to backend service (or other threads). In order to return result to same Client after backend processing is completed, system usually maintains a mapping table (Map).']}),"\n",(0,a.jsxs)(t.ol,{children:["\n",(0,a.jsx)(t.li,{children:"Normal Flow (a|b|)"}),"\n",(0,a.jsx)(t.li,{children:"Request: Client sends 1001|Data."}),"\n",(0,a.jsx)(t.li,{children:'Mapping: Netty parses sequence number 1001, records mapping relationship: Map.put("1001", Client_Channel_A).'}),"\n",(0,a.jsx)(t.li,{children:"Forward: Netty forwards request to backend."}),"\n",(0,a.jsx)(t.li,{children:"Response: Backend processing completed, brings back sequence number 1001|Result."}),"\n",(0,a.jsx)(t.li,{children:'Routing: Netty receives response, checks table Map.get("1001"), finds Client_Channel_A.'}),"\n",(0,a.jsx)(t.li,{children:"Reply: Writes result back to Client through Client_Channel_A."}),"\n"]}),"\n",(0,a.jsx)(t.h2,{id:"java-property-type-impact-on-netty",children:"Java Property Type Impact on Netty"}),"\n",(0,a.jsxs)(t.p,{children:["Problem: When refactoring primitive types to wrapper types, if using Spring injection, note that default values will change, boolean default value is false, ",(0,a.jsx)("br",{}),"\nWrapper class is null, may cause NullPointerException.",(0,a.jsx)("br",{}),"\nChange boolean to Boolean value, some scenarios (netty does not respond to request) will have problems.",(0,a.jsx)("br",{}),"\nHandling: Assign false to Boolean class"]}),"\n","\n",(0,a.jsx)(r.A,{})]})}function u(e={}){let{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}}}]);