"use strict";(self.webpackChunksummary=self.webpackChunksummary||[]).push([["7321"],{7583(e,r,t){t.r(r),t.d(r,{metadata:()=>o,default:()=>m,frontMatter:()=>s,contentTitle:()=>c,toc:()=>l,assets:()=>d});var o=JSON.parse('{"id":"background/Java/Spring/Core/bean-factory-post-processor","title":"BeanFactoryPostProcessor","description":"Please refer to [spring-framework](https://github.com/Halcyon666/spring-framework-modified/tree/main/spring-test) for code related to this article (from official source spring-test module)","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/background/Java/Spring/Core/bean-factory-post-processor.mdx","sourceDirName":"background/Java/Spring/Core","slug":"/background/Java/Spring/Core/bean-factory-post-processor","permalink":"/en/background/Java/Spring/Core/bean-factory-post-processor","draft":false,"unlisted":false,"editUrl":"https://github.com/Halcyon666/summary/edit/main/docs/background/Java/Spring/Core/bean-factory-post-processor.mdx","tags":[{"inline":true,"label":"algorithm","permalink":"/en/tags/algorithm"},{"inline":true,"label":"computer-science","permalink":"/en/tags/computer-science"},{"inline":true,"label":"data-structures","permalink":"/en/tags/data-structures"}],"version":"current","lastUpdatedBy":"halcyon666","lastUpdatedAt":1769299200000,"sidebarPosition":10,"frontMatter":{"id":"bean-factory-post-processor","title":"BeanFactoryPostProcessor","sidebar_label":"BeanFactoryPostProcessor","sidebar_position":10,"description":"Please refer to [spring-framework](https://github.com/Halcyon666/spring-framework-modified/tree/main/spring-test) for code related to this article (from official source spring-test module)","tags":["algorithm","computer-science","data-structures"],"last_update":{"date":"2026-01-25","author":"halcyon666"},"sources":["spring-core"]},"sidebar":"tutorialSidebar","previous":{"title":"Bean Creation Process","permalink":"/en/background/Java/Spring/Core/bean-creating-process"},"next":{"title":"Spring Core","permalink":"/en/background/Java/Spring/Core/spring-core"}}'),n=t(62615),i=t(77545),a=t(4040);let s={id:"bean-factory-post-processor",title:"BeanFactoryPostProcessor",sidebar_label:"BeanFactoryPostProcessor",sidebar_position:10,description:"Please refer to [spring-framework](https://github.com/Halcyon666/spring-framework-modified/tree/main/spring-test) for code related to this article (from official source spring-test module)",tags:["algorithm","computer-science","data-structures"],last_update:{date:"2026-01-25",author:"halcyon666"},sources:["spring-core"]},c,d={},l=[{value:"BeanFactoryPostProcessor",id:"beanfactorypostprocessor",level:2},{value:"PropertyPlaceholderConfigurer",id:"propertyplaceholderconfigurer",level:3},{value:"PropertyOverrideConfigurer",id:"propertyoverrideconfigurer",level:3},{value:"CustomEditorConfigurer",id:"customeditorconfigurer",level:3},{value:"Custom PropertyEditor",id:"custom-propertyeditor",level:4}];function p(e){let r={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components},{Details:t}=r;return t||function(e,r){throw Error("Expected "+(r?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(r.p,{children:["Please refer to ",(0,n.jsx)(r.a,{href:"https://github.com/Halcyon666/spring-framework-modified/tree/main/spring-test",children:"spring-framework"})," under ",(0,n.jsx)(r.code,{children:"org.springframework.mylearntest"})," package for code related to this article (from ",(0,n.jsx)(r.a,{href:"https://github.com/spring-projects/spring-framework.git",title:"official source",children:"official source"})," spring-test module)."]}),"\n",(0,n.jsx)(r.p,{children:"Container Startup Stage"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:"Start of container startup, first will load Configuration MetaData through some way. Besides code way being more direct, in most cases, container needs to rely on certain tool classes (BeanDefinitionReader) to parse and analyze loaded Configuration MetaData, and group analyzed information into corresponding BeanDefinition, finally register these BeanDefinitions saving necessary bean definition information to corresponding BeanDefinitionRegistry, thus container startup work is completed."}),"\n"]}),"\n",(0,n.jsx)(r.p,{children:"Bean Instantiation Stage"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsx)(r.p,{children:"First stage: Now all bean definition information is registered to BeanDefinitionRegistry via BeanDefinition."}),"\n"]}),"\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsx)(r.p,{children:"Second stage: When a requester explicitly requests an object via container's getBean method, or when container needs to implicitly call getBean method due to dependency relationship. In this stage, container will first check if requested object has been initialized before. If not, it will instantiate requested object according to information provided by registered BeanDefinition, and inject dependencies for it. If this object implements certain callback interfaces, it will also assemble it according to callback interface requirements. After this object is assembled, container will immediately return it to requester for use."}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(r.h2,{id:"beanfactorypostprocessor",children:"BeanFactoryPostProcessor"}),"\n",(0,n.jsx)(r.p,{children:"Spring provides a container extension mechanism called BeanFactoryPostProcessor. This mechanism allows us to modify information saved in BeanDefinition registered to container before container instantiates corresponding objects. This is equivalent to adding a procedure at the end of first stage of container implementation, allowing us to do some extra operations on final BeanDefinition, such as modifying certain properties of bean definition, adding other information for bean definition etc."}),"\n",(0,n.jsxs)(r.p,{children:["If want to custom implement BeanFactoryPostProcessor, usually we need to implement ",(0,n.jsx)(r.code,{children:"org.springframework.beans.factory.config.BeanFactoryPostProcessor"})," interface. At this time, it may be necessary for implementation class to simultaneously implement Spring's ",(0,n.jsx)(r.code,{children:"org.springframework.core.Ordered"})," interface, to ensure each BeanFactoryPostProcessor can execute according to pre-set order (if order matters)."]}),"\n",(0,n.jsxs)(r.p,{children:["Among them, ",(0,n.jsx)(r.code,{children:"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"})," and ",(0,n.jsx)(r.code,{children:"org.springframework.beans.factory.config.PropertyOverrideConfigurer"})," are two more commonly used BeanFactoryPostProcessors."]}),"\n",(0,n.jsx)(r.h3,{id:"propertyplaceholderconfigurer",children:"PropertyPlaceholderConfigurer"}),"\n",(0,n.jsxs)(t,{children:[(0,n.jsx)("summary",{children:"xml configuration"}),(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-XML",children:'<?xml version="1.0" encoding="UTF-8"?>\n<beans xmlns="http://www.springframework.org/schema/beans"\n	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n	   xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">\n	\x3c!--	Used BeanFactoryPostProcessor--\x3e\n	\x3c!--	Data source configuration using PropertyPlaceholderConfigurer placeholder--\x3e\n	<bean class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">\n		<property name="locations">\n			<list>\n				<value>../conf/jdbc.properties</value>\n				<value>../conf/mail.properties</value>\n			</list>\n		</property>\n	</bean>\n\n	<bean id="dataSource" class="org.apache.commons.dbcp2.BasicDataSource" destroy-method="close">\n		<property name="url" value="${jdbc.url}"/>\n		<property name="driverClassName" value="${jdbc.driver}"/>\n		<property name="username" value="${jdbc.username}"/>\n		<property name="password" value="${jdbc.password}"/>\n		<property name="testOnBorrow" value="true"/>\n		<property name="testOnReturn" value="true"/>\n		<property name="testWhileIdle" value="true"/>\n		<property name="minEvictableIdleTimeMillis" value="180000"/>\n		<property name="timeBetweenEvictionRunsMillis" value="360000"/>\n		<property name="validationQuery" value="SELECT 1"/>\n		<property name="maxOpenPreparedStatements" value="100"/>\n	</bean>\n\n	\x3c!--  Use PropertyOverrideConfigurer to replace configuration in PropertyPlaceholderConfigurer--\x3e\n	<bean class="org.springframework.beans.factory.config.PropertyOverrideConfigurer">\n		<property name="location" value="../conf/pool-adjustment.properties"/>\n	</bean>\n</beans>\n'})})]}),"\n",(0,n.jsxs)(t,{children:[(0,n.jsx)("summary",{children:"jdbc.properties"}),(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-properties",children:"jdbc.url=jdbc:mysql://server/MAIN?useUnicode=true&characterEncoding=ms932&failOverReadOnly=false&roundRobinLoadBalance=true\njdbc.driver=com.mysql.jdbc.Driver\njdbc.username=root\njdbc.password=root\n"})})]}),"\n",(0,n.jsxs)(r.p,{children:["If ",(0,n.jsx)(r.code,{children:"org.apache.commons.dbcp2.BasicDataSource"})," errors, need to introduce dependency ",(0,n.jsx)(r.code,{children:'api("org.apache.commons:commons-dbcp2:2.1.1")'})]}),"\n",(0,n.jsxs)(r.p,{children:["When BeanFactory finishes loading all configuration information in first stage, property information of objects saved in BeanFactory only exists in form of placeholders, such as ",(0,n.jsx)(r.code,{children:"${jdbc.url}"}),", ",(0,n.jsx)(r.code,{children:"${jdbc.driver}"}),". When PropertyPlaceholderConfigurer is applied as BeanFactoryPostProcessor, it will use configuration information in properties configuration file to replace property values represented by placeholders in corresponding BeanDefinition. In this way, when entering second stage of container implementation to instantiate bean, property values in bean definition are finally replaced."]}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:["PropertyPlaceholderConfigurer not only loads configuration items from its configured properties files, but also checks Properties in Java's System class, can control behavior of loading or overriding System corresponding Properties via ",(0,n.jsx)(r.code,{children:"setSystemPropertiesMode()"})," or ",(0,n.jsx)(r.code,{children:"setSystemPropertiesModeName()"}),"."]}),"\n",(0,n.jsx)(r.li,{children:"PropertyPlaceholderConfigurer provides three modes: SYSTEM_PROPERTIES_MODE_FALLBACK, SYSTEM_PROPERTIES_MODE_NEVER and SYSTEM_PROPERTIES_MODE_OVERRIDE. Default used is SYSTEM_PROPERTIES_ MODE_FALLBACK, if corresponding configuration item is not found in properties file, then check in System's Properties, we can also choose not to check System's Properties or override it."}),"\n"]}),"\n",(0,n.jsx)(r.h3,{id:"propertyoverrideconfigurer",children:"PropertyOverrideConfigurer"}),"\n",(0,n.jsx)(r.p,{children:"Information configured in properties files usually is represented in plain text, PropertyOverrideConfigurer's parent class PropertyResourceConfigurer provides a protected type method convertPropertyValue, allowing subclasses to override this method to convert corresponding configuration items, such as decrypting encrypted string and then covering to corresponding bean definition. Of course, since PropertyPlaceholderConfigurer also inherits PropertyResourceConfigurer, we can also apply similar functions for PropertyPlaceholderConfigurer."}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.img,{src:"https://s2.loli.net/2023/07/22/xJKIuHdQwa19on5.png",alt:"image-20230722162007693"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-XML",children:'<bean class="org.springframework.beans.factory.config.PropertyOverrideConfigurer">\n    <property name="location" value="pool-adjustment.properties"/>\n</bean>\n'})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-properties",children:"dataSource.minEvictableIdleTimeMillis=1000\ndataSource.maxOpenPreparedStatements=50\n"})}),"\n",(0,n.jsx)(r.h3,{id:"customeditorconfigurer",children:"CustomEditorConfigurer"}),"\n",(0,n.jsx)(r.p,{children:"CustomEditorConfigurer is another type of BeanFactoryPostProcessor implementation, it just auxiliary registers information used in later stage to container, does not make any changes to BeanDefinition."}),"\n",(0,n.jsxs)(r.p,{children:["Some ",(0,n.jsx)(r.code,{children:"PropertyEditor: StringArrayPropertyEditor"})," provided by Spring. This PropertyEditor will convert CSV format string into form of String[] array, default is comma (,) separated string, but can specify custom string separator. ByteArrayPropertyEditor, CharArrayPropertyEditor etc. all belong to PropertyEditors with similar functions, refer to Javadoc to get corresponding detailed information."]}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:"ClassEditor. Based on String type class name, directly convert it to corresponding Class object, equivalent to effect completed by Class.forName(String). Can pass in value to be converted in form of String[] array to achieve same purpose as providing ClassArrayEditor."}),"\n",(0,n.jsx)(r.li,{children:"FileEditor. Spring provided PropertyEditor corresponding to java.io.File type. PropertyEditors also belonging to resource positioning include InputStreamEditor, URLEditor, etc."}),"\n",(0,n.jsx)(r.li,{children:"LocaleEditor. PropertyEditor for java.util.Locale type, format can refer to Javadoc description of LocaleEditor and Locale."}),"\n",(0,n.jsx)(r.li,{children:"PatternEditor. PropertyEditor for java.util.regex.Pattern introduced after Java SE 1.4, format can refer to Javadoc of java.util.regex.Pattern class."}),"\n"]}),"\n",(0,n.jsx)(r.p,{children:"The above PropertyEditors, container usually defaults to loading and using, so even if we don't tell container how to convert these types, container can still complete work correctly. But when type we need is not included in above mentioned PropertyEditors, we need to implement PropertyEditor for this type, and inform container via CustomEditorConfigurer, so that container uses appropriate PropertyEditor at appropriate time."}),"\n",(0,n.jsx)(r.h4,{id:"custom-propertyeditor",children:"Custom PropertyEditor"}),"\n",(0,n.jsx)(r.p,{children:"For Date type, different Locales, different systems have different requirements in presentation form. For example, this part of system needs date in yyyy-MM-dd form, that part of system might need yyyyMMdd form to convert date."}),"\n",(0,n.jsxs)(t,{children:[(0,n.jsx)("summary",{children:"DatePropertyEditor"}),(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-java",children:"package org.springframework.mylearntest.beanfactorypostprocessor;\n\nimport java.beans.PropertyEditorSupport;\nimport java.time.LocalDate;\nimport java.time.format.DateTimeFormatter;\n\npublic class DatePropertyEditor extends PropertyEditorSupport {\n    private String datePattern;\n\n    @Override\n    public void setAsText(String text) throws IllegalArgumentException {\n        DateTimeFormatter dateTimeFormatter = DateTimeFormatter.ofPattern(getDatePattern());\n        LocalDate dateValue = LocalDate.parse(text,dateTimeFormatter);\n        setValue(dateValue);\n    }\n\n    @Override\n    public String getAsText() {\n        return super.getAsText();\n    }\n\n    public String getDatePattern() {\n        return datePattern;\n    }\n\n    public void setDatePattern(String datePattern) {\n        this.datePattern = datePattern;\n    }\n}\n"})})]}),"\n",(0,n.jsx)(r.p,{children:"If only support one-way conversion from String to corresponding object type, just override method setAsText(String). If want to support two-way conversion, need to consider overriding getAsText() method simultaneously."}),"\n",(0,n.jsxs)(t,{children:[(0,n.jsx)("summary",{children:"DatePropertyEditorRegistrar"}),(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-java",children:"package org.springframework.mylearntest.beanfactorypostprocessor;\n\nimport org.springframework.beans.PropertyEditorRegistrar;\nimport org.springframework.beans.PropertyEditorRegistry;\n\nimport java.beans.PropertyEditor;\n\npublic class DatePropertyEditorRegistrar implements PropertyEditorRegistrar {\n    private PropertyEditor propertyEditor;\n\n    public PropertyEditor getPropertyEditor() {\n        return propertyEditor;\n    }\n\n    public void setPropertyEditor(PropertyEditor propertyEditor) {\n        this.propertyEditor = propertyEditor;\n    }\n\n    @Override\n    public void registerCustomEditors(PropertyEditorRegistry registry) {\n        registry.registerCustomEditor(java.util.Date.class, getPropertyEditor());\n    }\n}\n"})})]}),"\n",(0,n.jsxs)(t,{children:[(0,n.jsx)("summary",{children:"xml configuration"}),(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-XML",children:'<?xml version="1.0" encoding="UTF-8"?>\n<beans xmlns="http://www.springframework.org/schema/beans"\n       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"\n       xmlns:aop="http://www.springframework.org/schema/aop">\n\n    <bean class="org.springframework.beans.factory.config.CustomEditorConfigurer">\n        <property name="propertyEditorRegistrars">\n            <list>\n                <ref bean="datePropertyEditorRegistrar"/>\n            </list>\n        </property>\n    </bean>\n\n    <bean id="datePropertyEditorRegistrar" class="org.springframework.mylearntest.beanfactorypostprocessor.DatePropertyEditorRegistrar">\n        <property name="propertyEditor">\n            <ref bean="datePropertyEditor"/>\n        </property>\n    </bean>\n\n    <bean id="datePropertyEditor" class="org.springframework.mylearntest.beanfactorypostprocessor.DatePropertyEditor">\n        <property name="datePattern">\n            <value>yyyy/MM/dd</value>\n        </property>\n    </bean>\n</beans>\n'})})]}),"\n",(0,n.jsxs)(t,{children:[(0,n.jsx)("summary",{children:"Test Class"}),(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-java",children:'package org.springframework.mylearntest.beanfactorypostprocessor;\n\nimport org.springframework.context.ApplicationContext;\nimport org.springframework.context.support.ClassPathXmlApplicationContext;\n\npublic class Test4DateProp {\n    public static void main(String[] args) {\n        // applicationContext\n        ApplicationContext context = new ClassPathXmlApplicationContext("datepropertyeditor2.xml");\n        DatePropertyEditor datePropertyEditor = (DatePropertyEditor) context.getBean("datePropertyEditor");\n        datePropertyEditor.setAsText("2020/06/21");\n    }\n}\n'})})]}),"\n",(0,n.jsxs)(r.blockquote,{children:["\n",(0,n.jsx)(r.p,{children:"References"}),"\n",(0,n.jsxs)(r.ol,{children:["\n",(0,n.jsx)(r.li,{children:"Book Name: Spring Unveiled Author: Wang Fuqiang"}),"\n"]}),"\n"]}),"\n","\n",(0,n.jsx)(a.A,{})]})}function m(e={}){let{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(p,{...e})}):p(e)}}}]);