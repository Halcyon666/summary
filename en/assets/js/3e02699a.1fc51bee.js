"use strict";(self.webpackChunksummary=self.webpackChunksummary||[]).push([["2677"],{17708(e,n,r){r.r(n),r.d(n,{metadata:()=>s,default:()=>u,frontMatter:()=>t,contentTitle:()=>d,toc:()=>a,assets:()=>l});var s=JSON.parse('{"id":"devops/Docker/docker-compose-configure-redis-cluster-jenkins","title":"Docker Compose Usage","description":"[reference article from here][docker compose redis cluster] > remember to replace the ip 192.168.3.163 to your real ip address","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/devops/Docker/docker-compose-configure-redis-cluster-jenkins.mdx","sourceDirName":"devops/Docker","slug":"/devops/Docker/docker-compose-configure-redis-cluster-jenkins","permalink":"/en/devops/Docker/docker-compose-configure-redis-cluster-jenkins","draft":false,"unlisted":false,"editUrl":"https://github.com/Halcyon666/summary/edit/main/docs/devops/Docker/docker-compose-configure-redis-cluster-jenkins.mdx","tags":[{"inline":true,"label":"containerization","permalink":"/en/tags/containerization"},{"inline":true,"label":"devops","permalink":"/en/tags/devops"},{"inline":true,"label":"docker","permalink":"/en/tags/docker"}],"version":"current","lastUpdatedBy":"halcyon666","lastUpdatedAt":1769299200000,"sidebarPosition":10,"frontMatter":{"id":"docker-compose-configure-redis-cluster-jenkins","title":"Docker Compose Usage","sidebar_label":"Docker Compose Usage","sidebar_position":10,"description":"[reference article from here][docker compose redis cluster] > remember to replace the ip 192.168.3.163 to your real ip address","tags":["containerization","devops","docker"],"last_update":{"date":"2026-01-25","author":"halcyon666"},"sources":["docker-command-and-dockerfile"]},"sidebar":"tutorialSidebar","previous":{"title":"Basic Docker Commands","permalink":"/en/devops/Docker/docker-command-and-dockerfile"},"next":{"title":"Docker Desktop Configuration","permalink":"/en/devops/Docker/docker-destop-configuration"}}'),o=r(62615),i=r(77545),c=r(4040);let t={id:"docker-compose-configure-redis-cluster-jenkins",title:"Docker Compose Usage",sidebar_label:"Docker Compose Usage",sidebar_position:10,description:"[reference article from here][docker compose redis cluster] > remember to replace the ip 192.168.3.163 to your real ip address",tags:["containerization","devops","docker"],last_update:{date:"2026-01-25",author:"halcyon666"},sources:["docker-command-and-dockerfile"]},d,l={},a=[{value:"Build Redis Cluster",id:"build-redis-cluster",level:2},{value:"Write Redis Configuration File",id:"write-redis-configuration-file",level:3},{value:"Script to Create Multiple Nodes",id:"script-to-create-multiple-nodes",level:3},{value:"Create docker-compose File",id:"create-docker-compose-file",level:3},{value:"Start Redis Cluster",id:"start-redis-cluster",level:3},{value:"Allocate Slots",id:"allocate-slots",level:3},{value:"Connect to Redis",id:"connect-to-redis",level:3},{value:"Jenkins in Docker Compose",id:"jenkins-in-docker-compose",level:2},{value:"docker-compose Configuration",id:"docker-compose-configuration",level:3},{value:"Run docker compose",id:"run-docker-compose",level:3},{value:"Get Initial Admin Password",id:"get-initial-admin-password",level:3},{value:"Configure IDEA Project-Docker",id:"configure-idea-project-docker",level:3},{value:"MySQL Docker Compose",id:"mysql-docker-compose",level:3},{value:"Redis Sentinel",id:"redis-sentinel",level:2}];function m(e){let n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h2,{id:"build-redis-cluster",children:"Build Redis Cluster"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.a,{href:"https://www.cnblogs.com/zhangrui153169/p/12835681.html",children:"Reference Article"})}),"\n",(0,o.jsx)(n.h3,{id:"write-redis-configuration-file",children:"Write Redis Configuration File"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"Remember to replace IP 192.168.3.163 with your real IP address"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",metastring:"script",children:"cd /docker/redis\n\ntee redis-cluster.tmpl <<- 'EOF'\n# redis port\nport ${PORT}\n# Turn off protected mode\nprotected-mode no\n# Enable cluster\ncluster-enabled yes\n# Cluster node config\ncluster-config-file nodes.conf\n# Timeout\ncluster-node-timeout 5000\n# Cluster node IP host mode is host machine IP\ncluster-announce-ip 192.168.3.163\n# Cluster node port 7001 - 7006\ncluster-announce-port ${PORT}\ncluster-announce-bus-port 1${PORT}\n# Enable appendonly backup mode\nappendonly yes\n# Backup every second\nappendfsync everysec\n# When compressing aof file, whether to perform sync operation\nno-appendfsync-on-rewrite no\n# When current aof file size exceeds 100% of aof file size at last rewrite, rewrite again\nauto-aof-rewrite-percentage 100\n# Min size of AOF file before rewrite default 64mb\nauto-aof-rewrite-min-size 64mb\nEOF\n"})}),"\n",(0,o.jsx)(n.h3,{id:"script-to-create-multiple-nodes",children:"Script to Create Multiple Nodes"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",metastring:"script",children:"tee redis-cluster-config.sh <<- 'EOF'\nfor port in `seq 7001 7006`; do \\\n  mkdir -p ./redis-cluster/${port}/conf \\\n  && PORT=${port} envsubst < ./redis-cluster.tmpl > ./redis-cluster/${port}/conf/redis.conf \\\n  && mkdir -p ./redis-cluster/${port}/data; \\\n  done\nEOF\nchmod 777 redis-cluster-config.sh\n./redis-cluster-config.sh\n\n"})}),"\n",(0,o.jsx)(n.h3,{id:"create-docker-compose-file",children:"Create docker-compose File"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",metastring:"script",children:'tee docker-compose.yml <<- \'EOF\'\n\nversion: \'3.7\'\n\nservices:\n  redis7001:\n    image: \'redis\'\n    container_name: redis7001\n    command:\n      ["redis-server", "/usr/local/etc/redis/redis.conf"]\n    volumes:\n      - ./redis-cluster/7001/conf/redis.conf:/usr/local/etc/redis/redis.conf\n      - ./redis-cluster/7001/data:/data\n    ports:\n      - "7001:7001"\n      - "17001:17001"\n    environment:\n      # Set timezone to Shanghai, otherwise time will be wrong\n      - TZ=Asia/Shanghai\n\n\n  redis7002:\n    image: \'redis\'\n    container_name: redis7002\n    command:\n      ["redis-server", "/usr/local/etc/redis/redis.conf"]\n    volumes:\n      - ./redis-cluster/7002/conf/redis.conf:/usr/local/etc/redis/redis.conf\n      - ./redis-cluster/7002/data:/data\n    ports:\n      - "7002:7002"\n      - "17002:17002"\n    environment:\n      # Set timezone to Shanghai, otherwise time will be wrong\n      - TZ=Asia/Shanghai\n\n\n  redis7003:\n    image: \'redis\'\n    container_name: redis7003\n    command:\n      ["redis-server", "/usr/local/etc/redis/redis.conf"]\n    volumes:\n      - ./redis-cluster/7003/conf/redis.conf:/usr/local/etc/redis/redis.conf\n      - ./redis-cluster/7003/data:/data\n    ports:\n      - "7003:7003"\n      - "17003:17003"\n    environment:\n      # Set timezone to Shanghai, otherwise time will be wrong\n      - TZ=Asia/Shanghai\n\n\n  redis7004:\n    image: \'redis\'\n    container_name: redis7004\n    command:\n      ["redis-server", "/usr/local/etc/redis/redis.conf"]\n    volumes:\n      - ./redis-cluster/7004/conf/redis.conf:/usr/local/etc/redis/redis.conf\n      - ./redis-cluster/7004/data:/data\n    ports:\n      - "7004:7004"\n      - "17004:17004"\n    environment:\n      # Set timezone to Shanghai, otherwise time will be wrong\n      - TZ=Asia/Shanghai\n\n\n  redis7005:\n    image: \'redis\'\n    container_name: redis7005\n    command:\n      ["redis-server", "/usr/local/etc/redis/redis.conf"]\n    volumes:\n      - ./redis-cluster/7005/conf/redis.conf:/usr/local/etc/redis/redis.conf\n      - ./redis-cluster/7005/data:/data\n    ports:\n      - "7005:7005"\n      - "17005:17005"\n    environment:\n      # Set timezone to Shanghai, otherwise time will be wrong\n      - TZ=Asia/Shanghai\n\n\n  redis7006:\n    image: \'redis\'\n    container_name: redis7006\n    command:\n      ["redis-server", "/usr/local/etc/redis/redis.conf"]\n    volumes:\n      - ./redis-cluster/7006/conf/redis.conf:/usr/local/etc/redis/redis.conf\n      - ./redis-cluster/7006/data:/data\n    ports:\n      - "7006:7006"\n      - "17006:17006"\n    environment:\n      # Set timezone to Shanghai, otherwise time will be wrong\n      - TZ=Asia/Shanghai\nEOF\n'})}),"\n",(0,o.jsx)(n.h3,{id:"start-redis-cluster",children:"Start Redis Cluster"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.code,{children:"docker-compose -f docker-compose-redis-cluster.yml up"})}),"\n",(0,o.jsx)(n.p,{children:"Stop and delete network rediscluster_default using following command"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.code,{children:"docker-compose -f docker-compose-redis-cluster.yml down"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.code,{children:"docker-compose -f docker-compose-redis-cluster.yml stop"})}),"\n",(0,o.jsx)(n.h3,{id:"allocate-slots",children:"Allocate Slots"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"docker exec -it redis7001 redis-cli -p 7001 --cluster create 192.168.3.163:7001 192.168.3.163:7002 192.168.3.163:7003 192.168.3.163:7004 192.168.3.163:7005 192.168.3.163:7006 --cluster-replicas 1\n"})}),"\n",(0,o.jsx)(n.p,{children:"If slots are not allocated, here are some solutions:"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.a,{href:"https://blog.csdn.net/one312/article/details/104983140",children:"solve slots not served"})}),"\n",(0,o.jsx)(n.h3,{id:"connect-to-redis",children:"Connect to Redis"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.code,{children:"docker exec -it redis7001 redis-cli -p 7001"})}),"\n",(0,o.jsx)(n.h2,{id:"jenkins-in-docker-compose",children:"Jenkins in Docker Compose"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.a,{href:"https://adamtheautomator.com/jenkins-docker/#Running_Jenkins_in_Docker",children:"This article references"})}),"\n",(0,o.jsx)(n.h3,{id:"docker-compose-configuration",children:"docker-compose Configuration"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"tee docker-compose-jenkins.yml <<- 'EOF'\n# docker-compose.yml\nversion: '3.7'\nservices:\n  jenkins:\n    image: jenkins/jenkins:lts\n    privileged: true\n    user: root\n    ports:\n      - 8083:8080\n      - 50003:50000\n    container_name: my-jenkins-3\n    volumes:\n      - ~/data:/var/jenkins_home\n      - /var/run/docker.sock:/var/run/docker.sock\nEOF\n"})}),"\n",(0,o.jsx)(n.h3,{id:"run-docker-compose",children:"Run docker compose"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.code,{children:"docker-compose -f docker-compose-jenkins.yml up -d"})}),"\n",(0,o.jsx)(n.h3,{id:"get-initial-admin-password",children:"Get Initial Admin Password"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.code,{children:"docker exec my-jenkins-3 cat /var/jenkins_home/secrets/initialAdminPassword"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["If reprinting, must not delete original address, must not delete address of others' blogs cited in text.\n",(0,o.jsx)(n.a,{href:"https://www.cnblogs.com/zhangrui153169/p/12835681.html",children:"Reference Blog redis cluster build"}),"\n",(0,o.jsx)(n.a,{href:"https://blog.csdn.net/one312/article/details/104983140",children:"Reference Blog slots not served"})]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"configure-idea-project-docker",children:"Configure IDEA Project-Docker"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yml",children:"version: '3.7'\nservices:\n  ideau:\n    image: 'jetbrains/projector-idea-u:2020.2-projector-v1.7.0'\n    container_name: ideau\n    volumes:\n      - /project:/home/projector-user\n      \n    ports:\n      - \"8887:8887\"\n    environment:\n      # Set timezone to Shanghai, otherwise time will be wrong\n      - TZ=Asia/Shanghai\n"})}),"\n",(0,o.jsx)(n.h3,{id:"mysql-docker-compose",children:"MySQL Docker Compose"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"mkdir -p /dockerlearn/docker-compose/mysql/{mydir,datadir,conf,source}\n"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:"tee my.cnf <<- 'EOF'\n[mysqld]\nskip_ssl\nuser=mysql\ndefault-storage-engine=INNODB\ncharacter-set-server=utf8\ncharacter-set-client-handshake=FALSE\ncollation-server=utf8_unicode_ci\ninit_connect='SET NAMES utf8'\n[client]\ndefault-character-set=utf8\n[mysql]\ndefault-character-set=utf8\nEOF\n"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yml",children:"tee docker-compose.yml <<- 'EOF'\nversion: '3'\nservices:\n  mysql:\n    restart: always\n    image: mysql:latest\n    container_name: ai-dream\n    volumes:\n      - /dockerlearn/docker-compose/mysql/mydir:/mydir\n      - /dockerlearn/docker-compose/mysql/datadir:/var/lib/mysql\n      - /dockerlearn/docker-compose/mysql/conf/my.cnf:/etc/my.cnf\n      # Database restore directory can place sql files that need to be restored here\n      - /apps/mysql/source:/docker-entrypoint-initdb.d\n    environment:\n      - \"MYSQL_ROOT_PASSWORD=root\"\n      - \"MYSQL_DATABASE=ai-dream\"\n      - \"TZ=Asia/Shanghai\"\n    ports:\n      # Use host's 3306 port mapped to container's 3306 port\n      # host: container\n      - 3306:3306\nEOF\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.a,{href:"https://www.cnblogs.com/zengyu1234/p/16843338.html",children:"Solution to Error: Public Key Retrieval is not allowed when connecting to MySQL"})}),"\n",(0,o.jsx)(n.p,{children:"Solution: Connection settings - Driver properties - allowPublicKeyRetrieval=false (Transport public key retrieval is disabled by default here, need to enable it), change to allowPublicKeyRetrieval=true."}),"\n",(0,o.jsx)(n.h2,{id:"redis-sentinel",children:"Redis Sentinel"}),"\n","\n",(0,o.jsx)(c.A,{})]})}function u(e={}){let{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(m,{...e})}):m(e)}}}]);