"use strict";(self.webpackChunksummary=self.webpackChunksummary||[]).push([["5710"],{70906:function(e,n,a){a.r(n),a.d(n,{frontMatter:()=>s,toc:()=>d,default:()=>k,metadata:()=>r,assets:()=>t,contentTitle:()=>c});var r=JSON.parse('{"id":"background/Middleware/Kafka","title":"Kafka","description":"\u5982\u4F55\u4F7F\u7528Docker Compose\u90E8\u7F72Kafka","source":"@site/docs/01-background/03-Middleware/01-Kafka.mdx","sourceDirName":"01-background/03-Middleware","slug":"/background/Middleware/Kafka","permalink":"/summary/background/Middleware/Kafka","draft":false,"unlisted":false,"editUrl":"https://github.com/Halcyon666/summary/edit/main/docs/01-background/03-Middleware/01-Kafka.mdx","tags":[],"version":"current","lastUpdatedBy":"Halcyon666","lastUpdatedAt":1762213459000,"sidebarPosition":1,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Mybatis Plus\u5FEB\u901F\u5F00\u59CB","permalink":"/summary/background/DateBase/Mybatis-Plus quick start"},"next":{"title":"Redis","permalink":"/summary/background/Middleware/Redis"}}'),o=a(47259),i=a(55511),l=a(60145);let s={},c="Kafka",t={},d=[{value:"\u5982\u4F55\u4F7F\u7528Docker Compose\u90E8\u7F72Kafka",id:"\u5982\u4F55\u4F7F\u7528docker-compose\u90E8\u7F72kafka",level:2},{value:"\u62A5\u9519 could not be established. Broker may not be available",id:"\u62A5\u9519-could-not-be-established-broker-may-not-be-available",level:3},{value:"\u5982\u4F55\u4F7F\u7528\u547D\u4EE4\u884C\u64CD\u4F5C\u96C6\u7FA4",id:"\u5982\u4F55\u4F7F\u7528\u547D\u4EE4\u884C\u64CD\u4F5C\u96C6\u7FA4",level:2},{value:"\u5982\u4F55\u5728Spring Boot\u4E2D\u4F7F\u7528Kafka",id:"\u5982\u4F55\u5728spring-boot\u4E2D\u4F7F\u7528kafka",level:2},{value:"\u751F\u4EA7\u8005\u4F7F\u7528\u6CE8\u610F\u70B9",id:"\u751F\u4EA7\u8005\u4F7F\u7528\u6CE8\u610F\u70B9",level:2},{value:"\u89E6\u53D1Coordinator Rebalance",id:"\u89E6\u53D1coordinator-rebalance",level:2}];function h(e){let n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components},{Details:a}=n;return a||function(e,n){throw Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"kafka",children:"Kafka"})}),"\n",(0,o.jsx)(n.h2,{id:"\u5982\u4F55\u4F7F\u7528docker-compose\u90E8\u7F72kafka",children:"\u5982\u4F55\u4F7F\u7528Docker Compose\u90E8\u7F72Kafka"}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsxs)(n.p,{children:["\u501F\u9274github",(0,o.jsx)(n.a,{href:"https://github.com/conduktor/kafka-stack-docker-compose/tree/master",children:"\u4ED3\u5E93"}),(0,o.jsx)("br",{}),"\n\u4E0B\u9762\u793A\u4F8B\u4F7F\u7528\u6700\u7B80\u5355\u7684 ",(0,o.jsx)(n.code,{children:"zk-single-kafka-single.yml"})]})}),"\n",(0,o.jsx)(n.p,{children:"\u4EE5\u4E0B\u4E3A\u6B63\u786E\u793A\u4F8B\uFF1A"}),"\n",(0,o.jsx)(n.p,{children:"\u5BF9\u4ED3\u5E93\u4E2D\u7684\u6587\u4EF6\u4F5C\u4E86\u4E24\u5904\u8C03\u6574"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"\u8C03\u6574\u4E86\u8FDE\u63A5\u5730\u5740"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-diff",children:"-  KAFKA_ADVERTISED_LISTENERS: INTERNAL://kafka1:19092,EXTERNAL://${DOCKER_HOST_IP:-127.0.0.1}:9092,DOCKER://host.docker.internal:29092\n+  KAFKA_ADVERTISED_LISTENERS: INTERNAL://kafka1:19092,EXTERNAL://${DOCKER_HOST_IP:-192.168.3.163}:9092,DOCKER://host.docker.internal:29092\n"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"\u5728Zoo1\u548Ckafka1\u4E2D\u90FD\u6DFB\u52A0\u4E86\u65F6\u533A\uFF0C\u53EF\u4EE5\u89E3\u51B3\u65F6\u95F4\u4E0D\u5BF9\u7684\u95EE\u9898"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-diff",children:"+      TZ: Asia/Shanghai\n"})}),"\n",(0,o.jsxs)(a,{children:[(0,o.jsx)("summary",{children:"\u70B9\u51FB\u5C55\u5F00\u67E5\u770B\u5B8C\u6574\u914D\u7F6E\u6587\u4EF6"}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yml",children:'version: \'2.1\'\n\nservices:\n  zoo1:\n    image: confluentinc/cp-zookeeper:7.3.2\n    hostname: zoo1\n    container_name: zoo1\n    ports:\n      - "2181:2181"\n    environment:\n      ZOOKEEPER_CLIENT_PORT: 2181\n      ZOOKEEPER_SERVER_ID: 1\n      ZOOKEEPER_SERVERS: zoo1:2888:3888\n      TZ: Asia/Shanghai\n\n  kafka1:\n    image: confluentinc/cp-kafka:7.3.2\n    hostname: kafka1\n    container_name: kafka1\n    ports:\n      - "9092:9092"\n      - "29092:29092"\n      - "9999:9999"\n    environment:\n      KAFKA_ADVERTISED_LISTENERS: INTERNAL://kafka1:19092,EXTERNAL://${DOCKER_HOST_IP:-192.168.3.163}:9092,DOCKER://host.docker.internal:29092\n      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: INTERNAL:PLAINTEXT,EXTERNAL:PLAINTEXT,DOCKER:PLAINTEXT\n      KAFKA_INTER_BROKER_LISTENER_NAME: INTERNAL\n      KAFKA_ZOOKEEPER_CONNECT: "zoo1:2181"\n      KAFKA_BROKER_ID: 1\n      KAFKA_LOG4J_LOGGERS: "kafka.controller=INFO,kafka.producer.async.DefaultEventHandler=INFO,state.change.logger=INFO"\n      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1\n      KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR: 1\n      KAFKA_TRANSACTION_STATE_LOG_MIN_ISR: 1\n      KAFKA_JMX_PORT: 9999\n      KAFKA_JMX_HOSTNAME: ${DOCKER_HOST_IP:-127.0.0.1}\n      KAFKA_AUTHORIZER_CLASS_NAME: kafka.security.authorizer.AclAuthorizer\n      KAFKA_ALLOW_EVERYONE_IF_NO_ACL_FOUND: "true"\n      TZ: Asia/Shanghai\n    depends_on:\n      - zoo1\n'})})]}),"\n",(0,o.jsx)(n.h3,{id:"\u62A5\u9519-could-not-be-established-broker-may-not-be-available",children:"\u62A5\u9519 could not be established. Broker may not be available"}),"\n",(0,o.jsx)(n.p,{children:"\u8C03\u6574\u5916\u90E8\u8FDE\u63A5\u5730\u5740\u5373\u53EF\u89E3\u51B3\u95EE\u9898"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-log",children:"[| adminclient-1] org.apache.kafka.clients.NetworkClient : [AdminClient clientId=adminclient-1] \nConnection to node 1 (/127.0.0.1:9092) could not be established. Broker may not be available.\n"})}),"\n",(0,o.jsx)(n.h2,{id:"\u5982\u4F55\u4F7F\u7528\u547D\u4EE4\u884C\u64CD\u4F5C\u96C6\u7FA4",children:"\u5982\u4F55\u4F7F\u7528\u547D\u4EE4\u884C\u64CD\u4F5C\u96C6\u7FA4"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"# \u521B\u5EFAtopic\ndocker run --rm --network=host \\\n           confluentinc/cp-kafka:7.3.2 \\\n           kafka-topics --bootstrap-server=127.0.0.1:9092 \\\n                        --create \\\n                        --topic=my-topic \\\n                        --partitions=3 \\\n                        --replication-factor=1\n# \u751F\u4EA7\u6D88\u606F\ndocker run --tty --interactive \\\n           --rm \\\n           --network=host \\\n           confluentinc/cp-kafka:7.3.2 \\\n           kafka-console-producer --broker-list=127.0.0.1:9092 --topic=my-topic\n           \n# \u6D88\u8D39\u6D88\u606F  \ndocker run --tty --interactive \\\n           --rm \\\n           --network=host \\\n           confluentinc/cp-kafka:7.3.2 \\\n           kafka-console-consumer --bootstrap-server=127.0.0.1:9092 --topic=my-topic\n		   \n"})}),"\n",(0,o.jsx)(n.h2,{id:"\u5982\u4F55\u5728spring-boot\u4E2D\u4F7F\u7528kafka",children:"\u5982\u4F55\u5728Spring Boot\u4E2D\u4F7F\u7528Kafka"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.a,{href:"https://www.baeldung.com/spring-kafka",children:"\u53C2\u8003\u8D44\u6599"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.a,{href:"https://github.com/Halcyon666/kafka-learn",children:"\u53C2\u8003\u4ED3\u5E93\u4EE3\u7801"})}),"\n",(0,o.jsx)(n.p,{children:"\u4ED3\u5E93\u4EE3\u7801\u7B80\u5355\u4ECB\u7ECD\u4E86 Kafka\u521B\u5EFA\u5B57\u7B26\u4E32\u6D88\u606F\u548CPojo\u6D88\u606F\uFF0C\u53D1\u9001\u6D88\u606F\u7684\u793A\u4F8B\u3002"}),"\n",(0,o.jsx)(n.p,{children:"\u53C2\u8003\u8D44\u6599\u6D89\u53CA\u591A\u79CD\u7C7B\u578B\u6D88\u606F\u6DF7\u5408\u751F\u4EA7\u548C\u6D88\u8D39\u3002\u503C\u5F97\u5B66\u4E60\u548C\u501F\u9274\u3002"}),"\n",(0,o.jsx)(n.h2,{id:"\u751F\u4EA7\u8005\u4F7F\u7528\u6CE8\u610F\u70B9",children:"\u751F\u4EA7\u8005\u4F7F\u7528\u6CE8\u610F\u70B9"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\u4E00\u4E2AJVM\u4E0B\u4F7F\u7528\u4E00\u4E2A\u751F\u4EA7\u8005\u5373\u53EF\uFF0C\u591A\u4E2A\u751F\u4EA7\u8005\u53EF\u80FDOOM\uFF0C\u4E00\u4E2A\u751F\u4EA7\u8005",(0,o.jsx)(n.code,{children:"buffer.memory=32MB"})," \u3002"]}),"\n",(0,o.jsxs)(n.li,{children:["Batch\u8BBE\u8BA1\uFF0C\u9996\u5148\u770B",(0,o.jsx)(n.code,{children:"batch.size"})," \u662F\u5426\u6EE1\u8DB3\uFF0C\u4E0D\u6EE1\u8DB3\u518D\u770B",(0,o.jsx)(n.code,{children:"linger.ms"})," ,\u5F53\u7F13\u5B58\u6D88\u606F\u5230\u8FBE",(0,o.jsx)(n.code,{children:"buffer.memory"})," \u4F1A\u76F4\u63A5\u89E6\u53D1\u6D88\u606F\u53D1\u9001\u5230\u670D\u52A1\u5668\u3002"]}),"\n",(0,o.jsx)(n.li,{children:"acks, 0 -\u4E0D\u786E\u8BA4\uFF0C1-\u6240\u6709\u4E3B\u8282\u70B9\u5199\u5165\u6210\u529F\uFF0Call-\u6240\u6709\u8282\u70B9\u5199\u5165\u6210\u529F"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"\u89E6\u53D1coordinator-rebalance",children:"\u89E6\u53D1Coordinator Rebalance"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"\u7EC4\u6210\u5458\u6570\u91CF\u53D8\u5316"}),"\n",(0,o.jsx)(n.li,{children:"\u8BA2\u9605\u4E3B\u9898\u6570\u91CF\u53D8\u5316"}),"\n",(0,o.jsx)(n.li,{children:"\u8BA2\u9605\u4E3B\u9898\u5206\u533A\u6570\u53D8\u5316"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"\u5EFA\u8BAE"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"session.timeout.ms > 3 * hearbeat.interval.ms"})}),"\n",(0,o.jsxs)(n.li,{children:["\u63A7\u5236\u6D88\u8D39\u8005\u6D88\u8D39\u6D88\u606F\u7684\u65F6\u95F4\uFF0C\u4E0D\u8981\u8D85\u8FC7",(0,o.jsx)(n.code,{children:"max.poll.interval.ms"}),"\u914D\u7F6E\u65F6\u95F4"]}),"\n"]}),"\n","\n",(0,o.jsx)(l.A,{})]})}function k(e={}){let{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(h,{...e})}):h(e)}}}]);