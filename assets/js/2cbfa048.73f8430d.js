"use strict";(self.webpackChunksummary=self.webpackChunksummary||[]).push([["4142"],{76489:function(e,n,s){s.r(n),s.d(n,{frontMatter:()=>r,toc:()=>o,default:()=>h,metadata:()=>t,assets:()=>d,contentTitle:()=>a});var t=JSON.parse('{"id":"ai-bigdata/AI/prompt-engineering-roadmap/level-3-agent","title":"Level 3 - Agent \u67B6\u6784\u4E0E\u53EF\u89C2\u6D4B\u6027","description":"\u638C\u63E1\u667A\u80FD\u51B3\u7B56\u4E0E\u8DEF\u7531,\u5EFA\u7ACB Agent \u884C\u4E3A\u7684\u53EF\u89C2\u6D4B\u6027\u548C\u5BA1\u8BA1\u80FD\u529B","source":"@site/docs/ai-bigdata/AI/prompt-engineering-roadmap/level-3-agent.mdx","sourceDirName":"ai-bigdata/AI/prompt-engineering-roadmap","slug":"/ai-bigdata/AI/prompt-engineering-roadmap/level-3-agent","permalink":"/summary/ai-bigdata/AI/prompt-engineering-roadmap/level-3-agent","draft":false,"unlisted":false,"editUrl":"https://github.com/Halcyon666/summary/edit/main/docs/ai-bigdata/AI/prompt-engineering-roadmap/level-3-agent.mdx","tags":[{"inline":true,"label":"ai","permalink":"/summary/tags/ai"},{"inline":true,"label":"agent","permalink":"/summary/tags/agent"},{"inline":true,"label":"langgraph","permalink":"/summary/tags/langgraph"},{"inline":true,"label":"level-3","permalink":"/summary/tags/level-3"}],"version":"current","lastUpdatedBy":"halcyon666","lastUpdatedAt":1769299200000,"sidebarPosition":4,"frontMatter":{"id":"level-3-agent","title":"Level 3 - Agent \u67B6\u6784\u4E0E\u53EF\u89C2\u6D4B\u6027","sidebar_label":"Level 3 - Agent \u67B6\u6784","sidebar_position":4,"description":"\u638C\u63E1\u667A\u80FD\u51B3\u7B56\u4E0E\u8DEF\u7531,\u5EFA\u7ACB Agent \u884C\u4E3A\u7684\u53EF\u89C2\u6D4B\u6027\u548C\u5BA1\u8BA1\u80FD\u529B","tags":["ai","agent","langgraph","level-3"],"last_update":{"date":"2026-01-25","author":"halcyon666"}},"sidebar":"tutorialSidebar","previous":{"title":"Level 2 - RAG \u5E94\u7528\u5F00\u53D1","permalink":"/summary/ai-bigdata/AI/prompt-engineering-roadmap/level-2-rag"},"next":{"title":"Level 4 - \u5168\u6808\u843D\u5730","permalink":"/summary/ai-bigdata/AI/prompt-engineering-roadmap/level-4-production"}}'),i=s(35656),l=s(40059);let r={id:"level-3-agent",title:"Level 3 - Agent \u67B6\u6784\u4E0E\u53EF\u89C2\u6D4B\u6027",sidebar_label:"Level 3 - Agent \u67B6\u6784",sidebar_position:4,description:"\u638C\u63E1\u667A\u80FD\u51B3\u7B56\u4E0E\u8DEF\u7531,\u5EFA\u7ACB Agent \u884C\u4E3A\u7684\u53EF\u89C2\u6D4B\u6027\u548C\u5BA1\u8BA1\u80FD\u529B",tags:["ai","agent","langgraph","level-3"],last_update:{date:"2026-01-25",author:"halcyon666"}},a="\u9636\u6BB5\u4E09: Agent \u67B6\u6784\u4E0E\u53EF\u89C2\u6D4B\u6027 (Level 3)",d={},o=[{value:"\u524D\u7F6E\u80FD\u529B\u8981\u6C42",id:"\u524D\u7F6E\u80FD\u529B\u8981\u6C42",level:2},{value:"\u4E3A\u4EC0\u4E48\u9700\u8981\u8FD9\u4E2A\u9636\u6BB5",id:"\u4E3A\u4EC0\u4E48\u9700\u8981\u8FD9\u4E2A\u9636\u6BB5",level:2},{value:"\u6838\u5FC3\u80FD\u529B 1: LangGraph \u72B6\u6001\u56FE\u7F16\u7A0B",id:"\u6838\u5FC3\u80FD\u529B-1-langgraph-\u72B6\u6001\u56FE\u7F16\u7A0B",level:2},{value:"\u6838\u5FC3\u6982\u5FF5",id:"\u6838\u5FC3\u6982\u5FF5",level:3},{value:"\u5B9E\u6218\u4E00: Router Agent (\u8DEF\u7531\u5C42)",id:"\u5B9E\u6218\u4E00-router-agent-\u8DEF\u7531\u5C42",level:3},{value:"\u5B9E\u6218\u4E8C: \u81EA\u4E3B Agent (\u7814\u62A5\u751F\u6210\u5668)",id:"\u5B9E\u6218\u4E8C-\u81EA\u4E3B-agent-\u7814\u62A5\u751F\u6210\u5668",level:3},{value:"\u6838\u5FC3\u80FD\u529B 2: \u77E5\u8BC6\u56FE\u8C31 (GraphRAG)",id:"\u6838\u5FC3\u80FD\u529B-2-\u77E5\u8BC6\u56FE\u8C31-graphrag",level:2},{value:"\u6838\u5FC3\u80FD\u529B 3: LLM \u53EF\u89C2\u6D4B\u6027",id:"\u6838\u5FC3\u80FD\u529B-3-llm-\u53EF\u89C2\u6D4B\u6027",level:2},{value:"\u6838\u5FC3\u75DB\u70B9",id:"\u6838\u5FC3\u75DB\u70B9",level:3},{value:"\u67B6\u6784\u8BBE\u8BA1",id:"\u67B6\u6784\u8BBE\u8BA1",level:3},{value:"\u6838\u5FC3\u80FD\u529B 4: Agent \u5BA1\u8BA1\u65E5\u5FD7",id:"\u6838\u5FC3\u80FD\u529B-4-agent-\u5BA1\u8BA1\u65E5\u5FD7",level:2},{value:"\u6838\u5FC3\u539F\u5219",id:"\u6838\u5FC3\u539F\u5219",level:3},{value:"\u65E5\u5FD7\u8BB0\u5F55\u6807\u51C6",id:"\u65E5\u5FD7\u8BB0\u5F55\u6807\u51C6",level:3},{value:"\u6838\u5FC3\u80FD\u529B 5: FastAPI \u670D\u52A1\u5C01\u88C5",id:"\u6838\u5FC3\u80FD\u529B-5-fastapi-\u670D\u52A1\u5C01\u88C5",level:2},{value:"\u9636\u6BB5\u4EA7\u51FA\u6807\u51C6",id:"\u9636\u6BB5\u4EA7\u51FA\u6807\u51C6",level:2},{value:"\u8DEF\u7EBF\u56FE\u4F18\u5316\u5EFA\u8BAE",id:"\u8DEF\u7EBF\u56FE\u4F18\u5316\u5EFA\u8BAE",level:2}];function c(e){let n={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",input:"input",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"\u9636\u6BB5\u4E09-agent-\u67B6\u6784\u4E0E\u53EF\u89C2\u6D4B\u6027-level-3",children:"\u9636\u6BB5\u4E09: Agent \u67B6\u6784\u4E0E\u53EF\u89C2\u6D4B\u6027 (Level 3)"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u5468\u671F"}),": \u7B2C 6-8 \u5468",(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.strong,{children:"\u6838\u5FC3\u76EE\u6807"}),": \u638C\u63E1\u667A\u80FD\u51B3\u7B56\u4E0E\u8DEF\u7531,\u5EFA\u7ACB Agent \u884C\u4E3A\u7684\u53EF\u89C2\u6D4B\u6027\u548C\u5BA1\u8BA1\u80FD\u529B"]}),"\n",(0,i.jsx)(n.h2,{id:"\u524D\u7F6E\u80FD\u529B\u8981\u6C42",children:"\u524D\u7F6E\u80FD\u529B\u8981\u6C42"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u2705 \u5DF2\u638C\u63E1 RAG \u5E94\u7528\u5F00\u53D1 (Level 2)"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 \u5DF2\u5B9E\u73B0 Java-Python \u5F02\u6784\u7CFB\u7EDF\u901A\u4FE1"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 \u5DF2\u5EFA\u7ACB\u8BC4\u4F30\u4F53\u7CFB"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u4E3A\u4EC0\u4E48\u9700\u8981\u8FD9\u4E2A\u9636\u6BB5",children:"\u4E3A\u4EC0\u4E48\u9700\u8981\u8FD9\u4E2A\u9636\u6BB5"}),"\n",(0,i.jsxs)(n.p,{children:['RAG \u89E3\u51B3\u4E86"\u77E5\u8BC6\u83B7\u53D6"\u95EE\u9898,\u4F46\u590D\u6742\u5E94\u7528\u9700\u8981 AI \u80FD\u591F',(0,i.jsx)(n.strong,{children:"\u81EA\u4E3B\u51B3\u7B56"}),': \u4F55\u65F6\u68C0\u7D22\u3001\u68C0\u7D22\u4EC0\u4E48\u3001\u5982\u4F55\u7EC4\u5408\u591A\u4E2A\u6570\u636E\u6E90\u3002Agent \u67B6\u6784\u8BA9 AI \u4ECE"\u88AB\u52A8\u56DE\u7B54"\u5347\u7EA7\u4E3A"\u4E3B\u52A8\u89C4\u5212"\u3002']}),"\n",(0,i.jsx)(n.h2,{id:"\u6838\u5FC3\u80FD\u529B-1-langgraph-\u72B6\u6001\u56FE\u7F16\u7A0B",children:"\u6838\u5FC3\u80FD\u529B 1: LangGraph \u72B6\u6001\u56FE\u7F16\u7A0B"}),"\n",(0,i.jsx)(n.h3,{id:"\u6838\u5FC3\u6982\u5FF5",children:"\u6838\u5FC3\u6982\u5FF5"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"StateGraph"}),": \u5B9A\u4E49 Agent \u7684\u72B6\u6001\u548C\u8F6C\u6362"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Conditional Edge"}),": \u6839\u636E\u6761\u4EF6\u51B3\u5B9A\u4E0B\u4E00\u6B65"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Checkpointer"}),": \u6301\u4E45\u5316 Agent \u7684\u8BB0\u5FC6"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"\u5B9E\u6218\u4E00-router-agent-\u8DEF\u7531\u5C42",children:"\u5B9E\u6218\u4E00: Router Agent (\u8DEF\u7531\u5C42)"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u76EE\u6807"}),": Agent \u6839\u636E\u7528\u6237\u95EE\u9898\u81EA\u52A8\u51B3\u5B9A\u67E5\u8BE2\u54EA\u4E2A\u6570\u636E\u6E90"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from langgraph.graph import StateGraph, END\n\n# \u5B9A\u4E49\u72B6\u6001\nclass AgentState(TypedDict):\n    question: str\n    route: str\n    result: str\n\n# \u8DEF\u7531\u51B3\u7B56\u51FD\u6570\ndef route_question(state: AgentState) -> str:\n    question = state["question"]\n    # \u4F7F\u7528 LLM \u5224\u65AD\u95EE\u9898\u7C7B\u578B\n    decision = llm.invoke(f"\u8FD9\u4E2A\u95EE\u9898\u5E94\u8BE5\u67E5\u8BE2\u54EA\u4E2A\u6570\u636E\u6E90? \u95EE\u9898: {question}")\n    \n    if "\u6587\u6863" in decision:\n        return "milvus"\n    elif "\u5173\u7CFB" in decision:\n        return "neo4j"\n    else:\n        return "google"\n\n# \u6784\u5EFA\u72B6\u6001\u56FE\nworkflow = StateGraph(AgentState)\nworkflow.add_node("router", route_question)\nworkflow.add_node("milvus_search", lambda s: milvus_client.search(s["question"]))\nworkflow.add_node("neo4j_search", lambda s: neo4j_client.query(s["question"]))\nworkflow.add_node("google_search", lambda s: google_search(s["question"]))\n\n# \u6DFB\u52A0\u6761\u4EF6\u8FB9\nworkflow.add_conditional_edges(\n    "router",\n    lambda s: s["route"],\n    {\n        "milvus": "milvus_search",\n        "neo4j": "neo4j_search",\n        "google": "google_search"\n    }\n)\n\nworkflow.set_entry_point("router")\napp = workflow.compile()\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u5B9E\u6218\u4E8C-\u81EA\u4E3B-agent-\u7814\u62A5\u751F\u6210\u5668",children:"\u5B9E\u6218\u4E8C: \u81EA\u4E3B Agent (\u7814\u62A5\u751F\u6210\u5668)"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u6D41\u7A0B"}),": \u81EA\u52A8\u89C4\u5212\u5927\u7EB2 \u2192 \u5206\u6BB5\u641C\u7D22\u7D20\u6750 \u2192 \u6574\u5408\u5199\u4F5C \u2192 \u81EA\u6211\u53CD\u601D\u4FEE\u6539"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# \u7814\u62A5\u751F\u6210 Agent\nclass ReportState(TypedDict):\n    topic: str\n    outline: list[str]\n    sections: dict[str, str]\n    final_report: str\n\ndef plan_outline(state: ReportState) -> ReportState:\n    outline = llm.invoke(f"\u4E3A\u4E3B\u9898 \'{state[\'topic\']}\' \u751F\u6210\u7814\u62A5\u5927\u7EB2")\n    state["outline"] = outline.split("\\n")\n    return state\n\ndef research_section(state: ReportState, section: str) -> str:\n    materials = rag_search(section)\n    content = llm.invoke(f"\u57FA\u4E8E\u4EE5\u4E0B\u6750\u6599\u5199\u4F5C: {materials}")\n    return content\n\ndef self_reflect(state: ReportState) -> ReportState:\n    critique = llm.invoke(f"\u8BC4\u4F30\u8FD9\u4EFD\u7814\u62A5\u7684\u8D28\u91CF: {state[\'final_report\']}")\n    if "\u9700\u8981\u6539\u8FDB" in critique:\n        # \u91CD\u65B0\u751F\u6210\n        state = plan_outline(state)\n    return state\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u6838\u5FC3\u80FD\u529B-2-\u77E5\u8BC6\u56FE\u8C31-graphrag",children:"\u6838\u5FC3\u80FD\u529B 2: \u77E5\u8BC6\u56FE\u8C31 (GraphRAG)"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Neo4j \u5B9E\u6218"}),": \u5C06\u7EC4\u7EC7\u67B6\u6784\u6570\u636E\u5B58\u5165 Neo4j"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cypher",children:'// \u521B\u5EFA\u8282\u70B9\u548C\u5173\u7CFB\nCREATE (\u5F20\u4E09:Employee {name: "\u5F20\u4E09", title: "\u5DE5\u7A0B\u5E08"})\nCREATE (\u674E\u56DB:Employee {name: "\u674E\u56DB", title: "\u7ECF\u7406"})\nCREATE (\u738B\u4E94:Employee {name: "\u738B\u4E94", title: "\u603B\u76D1"})\n\nCREATE (\u5F20\u4E09)-[:REPORTS_TO]->(\u674E\u56DB)\nCREATE (\u674E\u56DB)-[:REPORTS_TO]->(\u738B\u4E94)\n\n// \u67E5\u8BE2: \u8C01\u662F\u5F20\u4E09\u7684\u8001\u677F\u7684\u8001\u677F?\nMATCH (\u5F20\u4E09:Employee {name: "\u5F20\u4E09"})-[:REPORTS_TO*2]->(boss)\nRETURN boss.name\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"GraphRAG"}),': \u89E3\u51B3"\u5168\u5C40\u6027\u95EE\u9898"']}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:'\u4F20\u7EDF RAG: \u53EA\u80FD\u56DE\u7B54"\u5C40\u90E8"\u95EE\u9898 (\u5355\u4E2A\u6587\u6863\u5185)'}),"\n",(0,i.jsx)(n.li,{children:'GraphRAG: \u53EF\u4EE5\u56DE\u7B54"\u5168\u5C40"\u95EE\u9898 (\u8DE8\u591A\u4E2A\u5B9E\u4F53\u7684\u5173\u7CFB)'}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u6838\u5FC3\u80FD\u529B-3-llm-\u53EF\u89C2\u6D4B\u6027",children:"\u6838\u5FC3\u80FD\u529B 3: LLM \u53EF\u89C2\u6D4B\u6027"}),"\n",(0,i.jsx)(n.h3,{id:"\u6838\u5FC3\u75DB\u70B9",children:"\u6838\u5FC3\u75DB\u70B9"}),"\n",(0,i.jsx)(n.p,{children:"\u4F20\u7EDF APM (\u5982 SkyWalking) \u76D1\u63A7\u4E0D\u4E86 AI \u7684\u56DE\u7B54\u8D28\u91CF"}),"\n",(0,i.jsx)(n.h3,{id:"\u67B6\u6784\u8BBE\u8BA1",children:"\u67B6\u6784\u8BBE\u8BA1"}),"\n",(0,i.jsxs)(n.p,{children:["\u96C6\u6210 ",(0,i.jsx)(n.strong,{children:"LangSmith"})," \u6216 ",(0,i.jsx)(n.strong,{children:"Arize Phoenix"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u5B9E\u6218\u573A\u666F"}),": \u8BB0\u5F55\u6BCF\u6B21\u7528\u6237\u63D0\u95EE\u548C AI \u56DE\u7B54"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from langsmith import Client\n\nlangsmith_client = Client()\n\n@langsmith_client.trace\ndef rag_query(question: str) -> str:\n    # 1. \u68C0\u7D22\n    docs = milvus_client.search(question)\n    \n    # 2. \u751F\u6210\u56DE\u7B54\n    answer = llm.invoke(f"\u57FA\u4E8E\u4EE5\u4E0B\u6587\u6863\u56DE\u7B54: {docs}\\n\\n\u95EE\u9898: {question}")\n    \n    # LangSmith \u81EA\u52A8\u8BB0\u5F55:\n    # - \u5EF6\u8FDF\n    # - Token \u6D88\u8017\n    # - \u8F93\u5165\u8F93\u51FA\n    # - \u4E2D\u95F4\u6B65\u9AA4\n    \n    return answer\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u76D1\u63A7\u6307\u6807"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u5EF6\u8FDF (P50, P95, P99)"}),"\n",(0,i.jsx)(n.li,{children:"Token \u6D88\u8017 (\u8F93\u5165 tokens, \u8F93\u51FA tokens, \u603B\u6210\u672C)"}),"\n",(0,i.jsx)(n.li,{children:"\u56DE\u7B54\u7684\u51C6\u786E\u6027\u8BC4\u5206 (\u901A\u8FC7 Ragas \u81EA\u52A8\u8BC4\u4F30)"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u6838\u5FC3\u80FD\u529B-4-agent-\u5BA1\u8BA1\u65E5\u5FD7",children:"\u6838\u5FC3\u80FD\u529B 4: Agent \u5BA1\u8BA1\u65E5\u5FD7"}),"\n",(0,i.jsx)(n.h3,{id:"\u6838\u5FC3\u539F\u5219",children:"\u6838\u5FC3\u539F\u5219"}),"\n",(0,i.jsx)(n.p,{children:"AI \u662F\u975E\u786E\u5B9A\u6027\u7684,\u5FC5\u987B\u8BB0\u5F55\u6BCF\u4E2A\u51B3\u7B56\u7528\u4E8E\u5408\u89C4\u6027\u5BA1\u8BA1"}),"\n",(0,i.jsx)(n.h3,{id:"\u65E5\u5FD7\u8BB0\u5F55\u6807\u51C6",children:"\u65E5\u5FD7\u8BB0\u5F55\u6807\u51C6"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u5FC5\u987B\u5305\u542B\u7684\u5B57\u6BB5"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u65F6\u95F4\u6233 (ISO 8601 \u683C\u5F0F)"}),"\n",(0,i.jsx)(n.li,{children:"\u7528\u6237 ID \u548C\u4F1A\u8BDD ID"}),"\n",(0,i.jsx)(n.li,{children:"Agent \u51B3\u7B56\u7C7B\u578B (\u8DEF\u7531\u9009\u62E9\u3001\u5DE5\u5177\u8C03\u7528\u3001\u6700\u7EC8\u56DE\u7B54)"}),"\n",(0,i.jsx)(n.li,{children:"\u8F93\u5165\u4E0A\u4E0B\u6587 (\u7528\u6237\u95EE\u9898\u3001\u68C0\u7D22\u5230\u7684\u6587\u6863)"}),"\n",(0,i.jsx)(n.li,{children:"\u8F93\u51FA\u7ED3\u679C (Agent \u7684\u51B3\u7B56\u548C\u7406\u7531)"}),"\n",(0,i.jsx)(n.li,{children:"Token \u6D88\u8017\u548C\u5EF6\u8FDF"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u5B58\u50A8\u65B9\u6848"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u7ED3\u6784\u5316\u65E5\u5FD7: \u4F7F\u7528 JSON \u683C\u5F0F\u5B58\u50A8\u5230 Elasticsearch"}),"\n",(0,i.jsxs)(n.li,{children:["\u5173\u7CFB\u578B\u5B58\u50A8: \u5173\u952E\u51B3\u7B56\u5B58\u5165 MySQL \u7684 ",(0,i.jsx)(n.code,{children:"agent_audit_log"})," \u8868"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u4EE3\u7801\u793A\u4F8B"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'import json\nfrom datetime import datetime\nimport time\n\ndef log_agent_decision(\n    user_id: str,\n    session_id: str,\n    decision_type: str,\n    input_context: dict,\n    output: dict,\n    tokens: int,\n    latency_ms: int\n):\n    """\n    \u8BB0\u5F55 Agent \u51B3\u7B56\u5BA1\u8BA1\u65E5\u5FD7\n    \n    Args:\n        user_id: \u7528\u6237 ID\n        session_id: \u4F1A\u8BDD ID (\u7528\u4E8E\u8FFD\u6EAF\u5B8C\u6574\u5BF9\u8BDD)\n        decision_type: \u51B3\u7B56\u7C7B\u578B (route_selection/tool_call/final_answer)\n        input_context: \u8F93\u5165\u4E0A\u4E0B\u6587 (\u5305\u542B\u95EE\u9898\u3001\u68C0\u7D22\u6587\u6863\u7B49)\n        output: \u8F93\u51FA\u7ED3\u679C (Agent \u7684\u51B3\u7B56\u548C\u7406\u7531)\n        tokens: Token \u6D88\u8017\n        latency_ms: \u5EF6\u8FDF (\u6BEB\u79D2)\n    """\n    audit_log = {\n        "timestamp": datetime.now().isoformat(),\n        "user_id": user_id,\n        "session_id": session_id,\n        "decision_type": decision_type,\n        "input": input_context,\n        "output": output,\n        "tokens": tokens,\n        "latency_ms": latency_ms\n    }\n    \n    # 1. \u5B58\u50A8\u5230 Elasticsearch (\u7528\u4E8E\u5168\u6587\u641C\u7D22\u548C\u5206\u6790)\n    es_client.index(index="agent_audit_log", document=audit_log)\n    \n    # 2. \u5173\u952E\u51B3\u7B56\u5B58\u5165 MySQL (\u7528\u4E8E\u5408\u89C4\u5BA1\u8BA1)\n    if decision_type in ["route_selection", "final_answer"]:\n        db.execute(\n            "INSERT INTO agent_audit_log (timestamp, user_id, session_id, data) VALUES (?, ?, ?, ?)",\n            (audit_log["timestamp"], user_id, session_id, json.dumps(audit_log))\n        )\n    \n    # 3. \u5982\u679C\u5EF6\u8FDF\u8D85\u8FC7 2\u79D2,\u8BB0\u5F55\u544A\u8B66\n    if latency_ms > 2000:\n        logger.warning(f"High latency detected: {latency_ms}ms for session {session_id}")\n\n# \u4F7F\u7528\u793A\u4F8B: \u5728 Router Agent \u4E2D\u96C6\u6210\u5BA1\u8BA1\u65E5\u5FD7\n@agent_wrapper\ndef router_agent(question: str, user_id: str, session_id: str):\n    start_time = time.time()\n    \n    # \u6267\u884C\u8DEF\u7531\u51B3\u7B56\n    route = decide_route(question)\n    \n    latency_ms = int((time.time() - start_time) * 1000)\n    \n    # \u8BB0\u5F55\u5BA1\u8BA1\u65E5\u5FD7\n    log_agent_decision(\n        user_id=user_id,\n        session_id=session_id,\n        decision_type="route_selection",\n        input_context={"question": question},\n        output={"route": route, "reason": "\u95EE\u9898\u6D89\u53CA\u6587\u6863\u68C0\u7D22"},\n        tokens=150,\n        latency_ms=latency_ms\n    )\n    \n    return route\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u5BA1\u8BA1\u65E5\u5FD7\u67E5\u8BE2\u793A\u4F8B"})," (\u7528\u4E8E\u5408\u89C4\u5BA1\u8BA1):"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# \u67E5\u8BE2\u67D0\u4E2A\u4F1A\u8BDD\u7684\u5B8C\u6574\u51B3\u7B56\u94FE\u8DEF\ndef get_session_audit_trail(session_id: str):\n    """\u901A\u8FC7 session_id \u8FFD\u6EAF\u5B8C\u6574\u5BF9\u8BDD"""\n    results = db.execute(\n        "SELECT * FROM agent_audit_log WHERE session_id = ? ORDER BY timestamp",\n        (session_id,)\n    )\n    return [json.loads(row[\'data\']) for row in results]\n\n# \u67E5\u8BE2\u9AD8\u5EF6\u8FDF\u51B3\u7B56 (\u7528\u4E8E\u6027\u80FD\u4F18\u5316)\ndef get_high_latency_decisions(threshold_ms: int = 2000):\n    """\u67E5\u627E\u6240\u6709\u5EF6\u8FDF\u8D85\u8FC7\u9608\u503C\u7684\u51B3\u7B56"""\n    query = {\n        "query": {\n            "range": {\n                "latency_ms": {"gte": threshold_ms}\n            }\n        }\n    }\n    return es_client.search(index="agent_audit_log", body=query)\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u6838\u5FC3\u80FD\u529B-5-fastapi-\u670D\u52A1\u5C01\u88C5",children:"\u6838\u5FC3\u80FD\u529B 5: FastAPI \u670D\u52A1\u5C01\u88C5"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u76EE\u6807"}),": \u5C06 LangGraph Agent \u5C01\u88C5\u4E3A RESTful API,\u4F9B Java \u8C03\u7528"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from fastapi import FastAPI\nfrom pydantic import BaseModel\n\napp = FastAPI()\n\nclass AgentRequest(BaseModel):\n    question: str\n    user_id: str\n    session_id: str\n\nclass AgentResponse(BaseModel):\n    answer: str\n    sources: list[str]\n    confidence: float\n    trace_id: str\n\n@app.post("/agent/query", response_model=AgentResponse)\nasync def agent_query(request: AgentRequest):\n    # \u8FD0\u884C Agent\n    result = agent_app.invoke({\n        "question": request.question,\n        "user_id": request.user_id,\n        "session_id": request.session_id\n    })\n    \n    return AgentResponse(\n        answer=result["answer"],\n        sources=result["sources"],\n        confidence=result["confidence"],\n        trace_id=result["trace_id"]\n    )\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u9636\u6BB5\u4EA7\u51FA\u6807\u51C6",children:"\u9636\u6BB5\u4EA7\u51FA\u6807\u51C6"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u5FC5\u987B\u5B8C\u6210\u7684\u4EA4\u4ED8\u7269"})," (\u4F5C\u4E3A\u8FDB\u5165 Level 4 \u7684\u524D\u7F6E\u6761\u4EF6):"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Agent \u5E94\u7528\u5C42"}),":"]}),"\n",(0,i.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u5B9E\u73B0\u81F3\u5C11 1 \u4E2A Router Agent,\u80FD\u591F\u5728 3 \u4E2A\u6570\u636E\u6E90\u4E2D\u667A\u80FD\u9009\u62E9 (Milvus/Neo4j/Google),\u51C6\u786E\u7387 > 80%"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u5B9E\u73B0\u81F3\u5C11 1 \u4E2A\u81EA\u4E3B\u51B3\u7B56 Agent (\u5982\u7814\u62A5\u751F\u6210\u5668\u6216\u591A\u6B65\u63A8\u7406 Agent),\u80FD\u591F\u5B8C\u6210\u5B8C\u6574\u4EFB\u52A1\u6D41\u7A0B"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u670D\u52A1\u5C01\u88C5\u5C42"}),":"]}),"\n",(0,i.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u5EFA\u7ACB FastAPI \u670D\u52A1\u5C01\u88C5 Agent,\u652F\u6301 RESTful API \u8C03\u7528"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u5B9E\u73B0 Java-Python \u7684\u6807\u51C6\u5316\u901A\u4FE1\u534F\u8BAE (\u4F7F\u7528 OpenAPI \u5B9A\u4E49\u63A5\u53E3,Java \u7AEF\u4F7F\u7528 Feign Client)"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u77E5\u8BC6\u56FE\u8C31\u5C42"}),":"]}),"\n",(0,i.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u5B8C\u6210 Neo4j \u77E5\u8BC6\u56FE\u8C31\u5B9E\u6218,\u81F3\u5C11\u5305\u542B 50 \u4E2A\u8282\u70B9\u548C\u5173\u7CFB,\u80FD\u591F\u56DE\u7B54\u591A\u8DF3\u67E5\u8BE2\u95EE\u9898"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u53EF\u89C2\u6D4B\u6027\u5C42"}),":"]}),"\n",(0,i.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u96C6\u6210 LLM \u53EF\u89C2\u6D4B\u6027\u5DE5\u5177 (LangSmith \u6216 Arize Phoenix),\u80FD\u591F\u67E5\u770B Trace \u94FE\u8DEF\u548C Token \u6D88\u8017"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u5B9E\u73B0\u5B8C\u6574\u7684 Agent \u5BA1\u8BA1\u65E5\u5FD7\u7CFB\u7EDF,\u5305\u542B\u6240\u6709\u5FC5\u9700\u5B57\u6BB5,\u53EF\u901A\u8FC7 session_id \u8FFD\u6EAF\u5B8C\u6574\u5BF9\u8BDD"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u80FD\u529B\u9A8C\u8BC1"}),":"]}),"\n",(0,i.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u80FD\u591F\u89E3\u91CA LangGraph \u7684 StateGraph \u3001Conditional Edge \u3001Checkpointer \u4E09\u4E2A\u6838\u5FC3\u6982\u5FF5"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u80FD\u591F\u8BBE\u8BA1\u5E76\u5B9E\u73B0\u4E00\u4E2A\u5B8C\u6574\u7684 Agent \u5BA1\u8BA1\u65E5\u5FD7\u7CFB\u7EDF,\u7B26\u5408\u91D1\u878D\u3001\u533B\u7597\u7B49\u5F3A\u76D1\u7BA1\u884C\u4E1A\u8981\u6C42"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u65F6\u95F4\u68C0\u67E5\u70B9"}),": \u5982\u679C\u8D85\u8FC7 3 \u5468\u4ECD\u672A\u5B8C\u6210,\u5EFA\u8BAE\u5148\u5B9E\u73B0\u7B80\u5355\u7684 Router Agent,\u518D\u9010\u6B65\u6DFB\u52A0\u590D\u6742\u529F\u80FD"]}),"\n",(0,i.jsx)(n.h2,{id:"\u8DEF\u7EBF\u56FE\u4F18\u5316\u5EFA\u8BAE",children:"\u8DEF\u7EBF\u56FE\u4F18\u5316\u5EFA\u8BAE"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u5B9E\u6218\u9879\u76EE"}),": \u5B9E\u73B0 ",(0,i.jsx)(n.strong,{children:"Audit Log"})," for Agent actions,\u8BB0\u5F55\u6BCF\u4E2A\u51B3\u7B56\u7528\u4E8E\u5408\u89C4,\u786E\u4FDD\u5728\u91D1\u878D\u3001\u533B\u7597\u7B49\u5F3A\u76D1\u7BA1\u884C\u4E1A\u53EF\u7528"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u4E0A\u4E00\u9636\u6BB5"}),": ",(0,i.jsx)(n.a,{href:"./level-2-rag",children:"Level 2 - RAG \u5E94\u7528\u5F00\u53D1\u4E0E\u5F02\u6784\u7CFB\u7EDF\u67B6\u6784"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u4E0B\u4E00\u9636\u6BB5"}),": ",(0,i.jsx)(n.a,{href:"./level-4-production",children:"Level 4 - \u5168\u6808\u843D\u5730\u4E0E\u751F\u4EA7\u4F18\u5316"})]})]})}function h(e={}){let{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}}}]);