<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-AI And BD/hadoop" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">hadoop | halcyon666</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://halcyon666.top/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://halcyon666.top/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://halcyon666.top/AI And BD/hadoop"><meta data-rh="true" property="og:locale" content="zh"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="google-site-verification" content="vagj8ng2T0VN92-bvbq6xTnbbGF0_ZJXDvV0E_Yu3jY"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="hadoop | halcyon666"><meta data-rh="true" name="description" content="hadoop版本"><meta data-rh="true" property="og:description" content="hadoop版本"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://halcyon666.top/AI And BD/hadoop"><link data-rh="true" rel="alternate" href="https://halcyon666.top/AI And BD/hadoop" hreflang="zh"><link data-rh="true" rel="alternate" href="https://halcyon666.top/en/AI And BD/hadoop" hreflang="en"><link data-rh="true" rel="alternate" href="https://halcyon666.top/AI And BD/hadoop" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://L275Z6TKIP-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-62NRN6R4XB"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-62NRN6R4XB",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="halcyon666" href="/opensearch.xml">

<script src="https://docusaurus.io/script.js"></script>
<script src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4872091594975928" async crossorigin="anonymous"></script><link rel="stylesheet" href="/assets/css/styles.d06c806f.css">
<script src="/assets/js/runtime~main.6a44e816.js" defer="defer"></script>
<script src="/assets/js/main.90c30893.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_Y_Cj" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top navbarHideable_R24N"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="My Site Logo" class="themedComponent_rRVo themedComponent--light_xUdq"><img src="/img/logo.png" alt="My Site Logo" class="themedComponent_rRVo themedComponent--dark_qJGI"></div><b class="navbar__title text--truncate">halcyon666</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/Java/JavaBase/lambda">blog</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_KCFY"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>中文</a><ul class="dropdown__menu"><li><a href="/AI And BD/hadoop" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh">中文</a></li><li><a href="/en/AI And BD/hadoop" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Halcyon666/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_pxWi"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_x2om colorModeToggle_qu3H"><button class="clean-btn toggleButton_b5vE toggleButtonDisabled_hgp4" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_dtts"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_lUZr"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_ldVm"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_KKQD"><div class="docsWrapper_ZPx0"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_S0Ib" type="button"></button><div class="docRoot_ZqLO"><aside class="theme-doc-sidebar-container docSidebarContainer_oJWj"><div class="sidebarViewport_O6bB"><div class="sidebar_CL35 sidebarWithHideableNavbar_xyDI"><a tabindex="-1" class="sidebarLogo_DhZX" href="/"><img src="/img/logo.png" alt="My Site Logo" class="themedComponent_rRVo themedComponent--light_xUdq"><img src="/img/logo.png" alt="My Site Logo" class="themedComponent_rRVo themedComponent--dark_qJGI"><b>halcyon666</b></a><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_JPBI"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Java/JavaBase/lambda">Java</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Frontend/JQuery-revese-selector">Frontend</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Algorithm/Base-Sort">Algorithm</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Python/Common Problems">Python</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/ReadBook/Computor theory/OS_LeanNotes">ReadBook</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/CollectLinks/useful_links">CollectLinks</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Container-Tech/docker/docker-chinese register mirror address">Container-Tech</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Linux/Common-Shell-Command">Linux</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Develop-Tools/Most used Git Commands">Develop-Tools</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Others/Windowns/software-use-case">Others</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/AI And BD/HBASE">AI And BD</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/AI And BD/HBASE">HBASE</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/AI And BD/flink">flink</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/AI And BD/hadoop">hadoop</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/intro">Halcyon666 Blog</a></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_XXwx"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_V8zB"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_IVyu"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_AqVH"><div class="docItemContainer_eNVB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_mG2_" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_jEV2"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">AI And BD</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">hadoop</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_cyj8 theme-doc-toc-mobile tocMobile_mRJ0"><button type="button" class="clean-btn tocCollapsibleButton_xxya">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>hadoop</h1>
<h2 class="anchor anchorWithHideOnScrollNavbar_rjk0" id="hadoop版本">hadoop版本<a href="#hadoop版本" class="hash-link" aria-label="hadoop版本的直接链接" title="hadoop版本的直接链接">​</a></h2>
<ol>
<li>
<p>Hadoop1.0：包括Common、HDFS、MapReduce</p>
</li>
<li>
<p>Hadoop2.0：包括Common、HDFS、MapReduce、YARN。Hadoop1.0和Hadoop2.0不兼容。从Hadoop2.7版本开始，包含了Ozone，从Hadoop2.10版本开始，包含了Submarine</p>
</li>
<li>
<p>Hadoop3.0：包括了Common、HDFS、MapReduce、YARN以及Ozone模块，最新的Hadoop3.0版本中包含了Submarine</p>
</li>
</ol>
<h2 class="anchor anchorWithHideOnScrollNavbar_rjk0" id="hadoop模块">hadoop模块<a href="#hadoop模块" class="hash-link" aria-label="hadoop模块的直接链接" title="hadoop模块的直接链接">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_rjk0" id="1-hadoop-common用于支持其他模块">1. Hadoop Common：用于支持其他模块<a href="#1-hadoop-common用于支持其他模块" class="hash-link" aria-label="1. Hadoop Common：用于支持其他模块的直接链接" title="1. Hadoop Common：用于支持其他模块的直接链接">​</a></h3>
<ol start="2">
<li>Hadoop Distributed File System (HDFS™)：分布式存储</li>
<li>Hadoop YARN：任务调度和资源管理</li>
<li>Hadoop MapReduce：基于YARN的分布式计算框架</li>
<li>Hadoop Ozone：对象存储</li>
<li>Hadoop Submarine：机器学习引擎</li>
</ol>
<h2 class="anchor anchorWithHideOnScrollNavbar_rjk0" id="hadoop安装">hadoop安装<a href="#hadoop安装" class="hash-link" aria-label="hadoop安装的直接链接" title="hadoop安装的直接链接">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_rjk0" id="单机安装及配置">单机安装及配置<a href="#单机安装及配置" class="hash-link" aria-label="单机安装及配置的直接链接" title="单机安装及配置的直接链接">​</a></h3>
<ul>
<li>Hadoop伪分布式安装.txt</li>
<li>Hadoop完全分布式搭建.txt</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_rjk0" id="hadoop20和hadoop30的区别">Hadoop2.0和Hadoop3.0的区别<a href="#hadoop20和hadoop30的区别" class="hash-link" aria-label="Hadoop2.0和Hadoop3.0的区别的直接链接" title="Hadoop2.0和Hadoop3.0的区别的直接链接">​</a></h3>
<ul>
<li><a href="https://www.jianshu.com/p/fb2fa03a2f03" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/fb2fa03a2f03</a></li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_rjk0" id="hdfs">HDFS<a href="#hdfs" class="hash-link" aria-label="HDFS的直接链接" title="HDFS的直接链接">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_rjk0" id="图解">图解<a href="#图解" class="hash-link" aria-label="图解的直接链接" title="图解的直接链接">​</a></h3>
<ul>
<li></li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_rjk0" id="namenode">namenode<a href="#namenode" class="hash-link" aria-label="namenode的直接链接" title="namenode的直接链接">​</a></h3>
<ul>
<li>
<p>作用</p>
<ul>
<li>管理DataNode和存储元数据(metadata)</li>
</ul>
</li>
<li>
<p>元数据</p>
<ul>
<li>
<p>a. 文件的存储路径
b. 文件的权限
c. 文件大小
d. Block大小
e. 文件和BlockID的映射关系
f. BlockID和DataNode的映射关系
g. 副本数量</p>
</li>
<li>
<p>元数据和文件中的具体内容无关</p>
</li>
<li>
<p>元数据大小是130~180B</p>
</li>
<li>
<p>a. 维系在内存中的目的是为了读写快
b. 维系在磁盘中的目的是为了崩溃恢复</p>
<ul>
<li>
<p>在磁盘上的存储文件</p>
<ul>
<li>edits：操作文件。记录写操作</li>
<li>fsimage：元镜像文件。记录元数据，这个文件中的元  数据往往是落后于内存中的元数据的</li>
</ul>
</li>
</ul>
</li>
<li>
<p>元数据的存储路径由hadoop.tmp.dir属性来决定,不指定或者写错则默认为/tmp下</p>
</li>
<li>
<p>当NameNode收到写请求，会先将这个请求写到edits_inprogress文件中，如果记录成功则更新内存中的元数据，如果内存中的元数据更新成功则给客户端返回一个ack(确认字符)表示成功，在这个过程中没有改动fsimage</p>
<ul>
<li></li>
</ul>
</li>
<li>
<p>随着HDFS运行时间的增长，edits_inprogress会越来越大，同时fsimage和内存中元数据的差距越来越大，需要在适当的时机更新fsimage，edits_inprogress文件会滚动，滚动出一个edits文件以及产生一个新的edits_inprogress</p>
<ul>
<li>空间：当edits文件达到指定大小（默认是64M，可以通过fs.checkpoint.size来调节，单位是字节）的时候，会滚动产生一个新的edits_inprogress</li>
<li>时间：当距离上一次滚动的间隔时间达到指定条件（默认是1H，可以通过fs.checkpoint.period来调节，单位是秒）的时候，会滚动产生一个新的edits_inprogress</li>
<li>强制：hadoop dfsadmin -rollEdits</li>
<li>重启：当NameNode重启的时候会自动触发edits文件的滚动</li>
</ul>
</li>
<li>
<p>NameNode通过心跳机制来管理DataNode</p>
<ul>
<li>
<p>默认心跳的间隔时间是3s，这个属性可以通过dfs.heartbeat.interval来调节，单位是秒</p>
</li>
<li>
<p>当NameNode超过10min没有收到DataNode的心跳，则认为这个节点已经lost（丢失），NameNode会将这个节点上的数据备份到其他节点上保证整个集群中的副本数量</p>
</li>
<li>
<p>心跳信号</p>
<ul>
<li>当前DataNode的状态(预服役、服役、预退役、退役)</li>
<li>DataNode中BlockID</li>
<li>clusterID - 集群编号。clusterID在NameNode被格式化(hadoop namenode -format)的时候产生，NameNode在启动的时候会将clusterID发送给每一个DataNode，当DataNode在发送  心跳的时候需要携带这个clusterID来进行校验的。DataNode只接受一次clusterID</li>
</ul>
</li>
</ul>
</li>
<li>
<p>NameNode/HDFS重启，会触发edits_inprogress文件的滚动，将操作更新到fsimage中，然后将fsimage文件中的内容加载到内存中，加载完成之后会等待DataNode的心跳，收到心跳之后进行校验，如果校验失败，NameNode会试图恢复这些数据然后重新校验，这个过程称之为安全模式。直到校验成功，NameNode会自动退出安全模式</p>
<ul>
<li>如果在合理时间内，安全模式没有退出，那么就意味着产生了数据的丢失，需要强制退出安全模式：hadoop dfsadmin -safemode leave</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_rjk0" id="datanode">datanode<a href="#datanode" class="hash-link" aria-label="datanode的直接链接" title="datanode的直接链接">​</a></h3>
<ul>
<li>
<p>block:数据将会按照指定的大小来分块</p>
<ul>
<li>
<p>分块的意义:1)能够存储超大文件 2)能够快速备份</p>
</li>
<li>
<p>作用</p>
<ul>
<li>存储Block，将Block存储在DataNode的磁盘上</li>
</ul>
</li>
<li>
<p>DataNode会定时向NameNode发送心跳信号
Block在磁盘上的存储位置由hadoop.tmp.dir来决定</p>
</li>
<li>
<p>默认为128M,通过dfs.blocksize(hdfs-site.xml)属性来配置，单位是字节</p>
</li>
<li>
<p>如果一个文件不足一个Block的默认大小，那么这个文件大小为实际大小</p>
</li>
<li>
<p>HDFS会对每一个Block分配一个全局递增的编号 - Block ID: 1073741825</p>
</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_rjk0" id="secondarynamenode">SecondaryNameNode<a href="#secondarynamenode" class="hash-link" aria-label="SecondaryNameNode的直接链接" title="SecondaryNameNode的直接链接">​</a></h3>
<ul>
<li>SecondaryNameNode不是NameNode的热备，而是辅助NameNode完成edits文件的滚动</li>
<li>在HDFS集群中，如果存在SecondaryNameNode，那么edits文件的滚动过程是由SecondaryNameNode完成；如果不存在SecondaryNameNode，那么edits文件的滚动过程就是由NameNode自己完成</li>
<li>HDFS设计的时候，采取了SecondaryNameNode+NameNode机制或者双NameNode机制，考虑NameNode的核心地位，必然要对NameNode进行备份，那也就意味着需要采用双NameNode机制，那么此时就需要舍弃SecondaryNameNode</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_rjk0" id="副本放置策略">副本放置策略<a href="#副本放置策略" class="hash-link" aria-label="副本放置策略的直接链接" title="副本放置策略的直接链接">​</a></h3>
<ul>
<li>
<p>第一个副本</p>
<ul>
<li>集群内部上传：哪个DataNode上传，第一个副本就放在哪个DataNode上
集群外部上传：NameNode会等待DataNode的心跳，然后选择一个相对空闲的DataNode来存储这个副本</li>
</ul>
</li>
<li>
<p>第二个副本</p>
<ul>
<li>Hadoop2.7之前：第二个副本是放在和第一个副本不同机架的节点上
Hadoop2.7开始：第二个副本是放在和第一个副本相同机架的节点上</li>
</ul>
</li>
<li>
<p>第三个副本</p>
<ul>
<li>Hadoop2.7之前：第三个副本是放在和第二个副本相同机架的节点上
Hadoop2.7开始：第三个副本是放在和第二个副本不同机架的节点上</li>
</ul>
</li>
<li>
<p>更多副本</p>
<ul>
<li>放在相对空闲的节点上</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_rjk0" id="机架感知策略">机架感知策略<a href="#机架感知策略" class="hash-link" aria-label="机架感知策略的直接链接" title="机架感知策略的直接链接">​</a></h3>
<ul>
<li>所谓的机架本质上就是一个Map，机架感知实际上
就是将一个节点的IP或者主机名映射到某个值上</li>
<li>机架指的是逻辑机架而不是物理机架，也就意味着可以将不同物理机架上的节点映射到同一个逻辑机架上，但是实际过程中往往是将同一个  物理机架上的节点映射到同一个逻辑机架上</li>
<li>机架感知策略需要通过脚本文件(Shell/Python)来指定</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_rjk0" id="回收站机制">回收站机制<a href="#回收站机制" class="hash-link" aria-label="回收站机制的直接链接" title="回收站机制的直接链接">​</a></h3>
<ul>
<li>HDFS中，回收站默认是不开启的，需要在配置文件中手动指定</li>
<li>配置回收站机制</li>
</ul>
<div class="language-shell codeBlockContainer_rRPo theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_k6B_"><pre tabindex="0" class="prism-code language-shell codeBlock_lunG thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_dNM2"><span class="token-line" style="color:#393A34"><span class="token plain">vim core-site.xml</span><br></span></code></pre><div class="buttonGroup_sYku"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_pVBx" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_uQin"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_R24k"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-xml codeBlockContainer_rRPo theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_k6B_"><pre tabindex="0" class="prism-code language-xml codeBlock_lunG thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_dNM2"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">&lt;!--指定文件在回收站中的存储时间--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">&lt;!--默认为0，单位是min--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">&lt;!--一个文件放在回收站中会存储一天的时间，如果超过一天没有还原，那么就会被清除--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">fs.trash.interval</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1440</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup_sYku"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_pVBx" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_uQin"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_R24k"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_rjk0" id="dfs目录">dfs目录<a href="#dfs目录" class="hash-link" aria-label="dfs目录的直接链接" title="dfs目录的直接链接">​</a></h3>
<ul>
<li>
<p>dfs目录是由hadoop.tmp.dir属性来决定
dfs目录是在NameNode被格式化的时候产生</p>
</li>
<li>
<p>dfs子目录</p>
<ul>
<li>a. data：对应的DataNode的存储位置
b. name：NameNode的存储位置
c. namesecondary：SecondaryNameNode的存储位置</li>
</ul>
</li>
<li>
<p>name data下文件</p>
<ul>
<li>in_use.lock用于标记当前服务器是否已经启动了对应的进程</li>
</ul>
</li>
<li>
<p>HDFS在第一次启动之后1min，edits文件会自动产生一次滚动
HDFS会将每一次的写操作看作是一个事务，分配一个全局递增的事务id，称之为txid</p>
</li>
<li>
<p>edits文件转化为xml文件的命令：hdfs oev -i edits_xxx -o a.xml</p>
</li>
<li>
<p>edits.xml文件结构</p>
<ul>
<li>
<p>每一个edits文件的开头都是OP_START_LOG_SEGMENT，每一个edits文件的结尾都是OP_END_LOG_SEGMENT</p>
</li>
<li>
<p>文件上传</p>
<ul>
<li>a. OP_ADD：在HDFS上 创建一个文件名._COPYING_文件，例如a.txt.<em>COPYING</em>
b. OP_ALLOCATE_BLOCK_ID：计算文件切块数量并且分配BlockID
c. OP_SET_GENSTAMP_V2：设置时间戳版本
d. OP_ADD_BLOCK：利用流向文件中添加数据
e. OP_CLOSE：关流
f. OP_RENAME_OLD：文件重命名</li>
</ul>
</li>
<li>
<p>文件一旦上传完成，那么文件内容不允许修改
fsimage.xxx.md5是对fsimage.xxx来进行校验</p>
</li>
</ul>
</li>
<li>
<p>VERSION</p>
<ul>
<li>a. clusterID：集群编号，用于校验
b. storageType：标记当前节点的类型
c. blockpoolID：块池编号</li>
<li></li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_rjk0" id="读取流程">读取流程<a href="#读取流程" class="hash-link" aria-label="读取流程的直接链接" title="读取流程的直接链接">​</a></h3>
<ul>
<li>
<ol>
<li>客户端发起RPC请求到NameNode</li>
</ol>
</li>
</ul>
<ol start="2">
<li>NameNode收到请求之后会检查要读取的路径（文件）是否存在</li>
<li>如果路径存在，则NameNode会给客户端返回一个信号表示可以读取</li>
<li>客户端收到信号之后，会向NameNode发送请求要第一个Block的地址</li>
<li>NameNode会将第一个Block的存储地址放入一个队列中返回给客户端</li>
<li>客户端收到地址之后，从这些地址中选取一个较近的节点来读取第一个Block。读完这个Block之后，会对这个Block进行校验，校验读取的Block和meta声明的信息是否一致</li>
<li>如果校验失败，那么客户端会通知NameNode，然后重新选取一个地址重新读取；如果校验成功，则客户端会去向NameNode要第二个Block的地址，重复4.5.6三个过程
直到读取完最后一个Block，客户端就会给NameNode发送一个结束信号，NameNode关闭文件（实际上就是关流）</li>
</ol>
<h3 class="anchor anchorWithHideOnScrollNavbar_rjk0" id="写入流程">写入流程<a href="#写入流程" class="hash-link" aria-label="写入流程的直接链接" title="写入流程的直接链接">​</a></h3>
<ul>
<li>
<ol>
<li>客户端发起RPC请求到NameNode</li>
</ol>
</li>
</ul>
<ol start="2">
<li>NameNode收到请求之后会进行校验：
a. 校验要写入的路径是否有权限
b. 校验路径下是否有同名文件</li>
<li>如果校验成功，会先添加元数据，NameNode会给客户端返回一个信号表示可以写入</li>
<li>客户端收到信号之后，向NameNode发送请求要第一个Block的存储地址</li>
<li>NameNode收到请求之后会给这个Block分配一个BlockID，然后等待DataNode的心跳，从中选取DataNode的地址（默认是3个）放入队列中返回给客户端</li>
<li>客户端收到地址之后，从这些地址中选取一个相对较近（网络拓扑距离）的节点来写入第一个Block的第一个副本。第一个副本所在节点再备份到其他节点上，也就意味着副本之间的备份用集群的内部备份方法来完成的，节点之间通过pipeline（管道，本质上就是一个NIO中的Channel）来进行备份。第三个副本备份完成之后会给第二个副本所在的节点返回一个ack信号，第二个副本所在的节点会给第一个副本所在的节点返回一个ack，第一个副本所在的节点最后给客户端返回一个ack</li>
<li>客户端再给NameNode发送请求要第二个Block的地址，重复4.5.6三个过程</li>
<li>直到客户端写完所有的Block，那么客户端会给NameNode发送一个结束信号，NameNode会关闭这个文件（实际上就是关流），此时文件不能再修改</li>
</ol>
<h3 class="anchor anchorWithHideOnScrollNavbar_rjk0" id="删除流程">删除流程<a href="#删除流程" class="hash-link" aria-label="删除流程的直接链接" title="删除流程的直接链接">​</a></h3>
<ul>
<li>
<ol>
<li>客户端发起RPC请求到NameNode</li>
</ol>
</li>
</ul>
<ol start="2">
<li>NameNode收到请求之后会查询元数据，然后校验当前用户是否删除权限</li>
<li>如果有删除权限，则NameNode会从元数据中将这条数据删除并且给客户端返回一个成功信号，此时只是元数据被修改而数据依然存储在DataNode上</li>
<li>当DataNode发送心跳信号的时候，NameNode会对心跳信号进行心跳响应，要求DataNode删除对应的Block，DataNode收到心跳响应之后才删除数据，此时数据才真正从HDFS上移除</li>
</ol>
<h2 class="anchor anchorWithHideOnScrollNavbar_rjk0" id="mapreduce">MapReduce<a href="#mapreduce" class="hash-link" aria-label="MapReduce的直接链接" title="MapReduce的直接链接">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_rjk0" id="概述">概述<a href="#概述" class="hash-link" aria-label="概述的直接链接" title="概述的直接链接">​</a></h3>
<ul>
<li>
<ol>
<li>MapReduce是Hadoop提供一套用于进行分布式计算的框架</li>
</ol>
</li>
</ul>
<ol start="2">
<li>MapReduce是根据Google的MapReduce来实现的</li>
<li>MapReduce将计算过程拆分为了Map阶段以及Reduce阶段</li>
</ol>
<ul>
<li></li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_rjk0" id="maven-打包指定主类配置">maven 打包指定主类配置<a href="#maven-打包指定主类配置" class="hash-link" aria-label="maven 打包指定主类配置的直接链接" title="maven 打包指定主类配置的直接链接">​</a></h3>
<div class="language-xml codeBlockContainer_rRPo theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_k6B_"><pre tabindex="0" class="prism-code language-xml codeBlock_lunG thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_dNM2"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">plugin</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.apache.maven.plugins</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">maven-jar-plugin</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">configuration</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">archive</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">manifest</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">addClasspath</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">addClasspath</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">mainClass</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">cn.App</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">mainClass</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">manifest</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">archive</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">configuration</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">plugin</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup_sYku"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_pVBx" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_uQin"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_R24k"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_rjk0" id="配置windowns-mapreduce运行环境">配置windowns MapReduce运行环境<a href="#配置windowns-mapreduce运行环境" class="hash-link" aria-label="配置windowns MapReduce运行环境的直接链接" title="配置windowns MapReduce运行环境的直接链接">​</a></h3>
<ul>
<li>
<p>配置HADOOP_HOME</p>
</li>
<li>
<p>配置HADOOP_USER_NAME</p>
<ul>
<li>root</li>
</ul>
</li>
<li>
<p>配置HADOOP bin环境</p>
</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_rjk0" id="数据本地化策略">数据本地化策略<a href="#数据本地化策略" class="hash-link" aria-label="数据本地化策略的直接链接" title="数据本地化策略的直接链接">​</a></h3>
<ul>
<li>
<p>当JobTracker收到请求之后会访问NameNode获取元数据，然后根据元数据信息来进行切片 - 切片是一个逻辑切分过程，此时数据并没有被真正切分，而是去划分每一个任务的任务量 - 切片数量决定了MapTask的数量</p>
</li>
<li>
<p>实际过程中 ，默认情况下，Split和Block大小是一致的</p>
</li>
<li>
<p>数据本地化</p>
<ul>
<li>a. 为了减少不同集群之间的数据传输，考虑将TaskTracker和DataNode放在相同节点上
b. 为了减少节点之间的数据传输，JobTracker在分配任务的时候会尽量将任务分配给有对应数据的节点</li>
</ul>
</li>
<li>
<p>切片过程</p>
<ul>
<li>a. 如果文件为空，则整个文件作为一个切片处理
b. 在MapReduce中，文件存在可切和不可切。如果文件不可切，则整个文件作为一个切片处理
c. 如果需要调大切片，需要调节minSize；如果需要调小切片，需要调节maxSize。MapReduce中并没有提供直接调节切片的方法
//默认 minSize 1byte maxSize 9223372036854775807L
return Math.max(minSize, Math.min(maxSize, blockSize));
d.在切片过程中，需要注意切片阈值：1.1，即当文件剩余的字节数量/切片大小&gt;1.1的时候才会按照切片大小来进行切分；如果剩余的字节数量/切片大小<code>&lt;=1.1</code>，则剩余的字节整个作为一个切片处理</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_rjk0" id="job提交流程">job提交流程<a href="#job提交流程" class="hash-link" aria-label="job提交流程的直接链接" title="job提交流程的直接链接">​</a></h3>
<ul>
<li>
<p>提交阶段</p>
<ul>
<li>a. 检查输入输出路径
b. 计算切片
c. 如果有需要，可以设置分布式缓存存根账户
d. 将jar包和配置提交到HDFS上
e. 将任务提交给JobTracker并且可以选择是否监控运行状态</li>
</ul>
</li>
<li>
<p>执行阶段</p>
<ul>
<li>a. JobTracker收到任务之后会将任务拆分成MapTask和ReduceTask，其中MapTask的数量由切片数量决定，ReduceTask的数量由分区数量决定
b. JobTracker在拆分完成之后，等待TaskTracker的心跳，当TaskTracker心跳过来之后，JobTracker就会给TaskTracker来分配任务。分配任务的时候，MapTask的分配要尽量满足数据本地化  策略，ReduceTask的分配要尽量放到相对空闲的节点上
c. TaskTracker通过心跳领取到了MapTask或者ReduceTask，然后请求对应的节点来下载jar包 - 体现了数据固定逻辑移动的思想
d. TaskTracker下载jar包之后，会在本节点上去开启一个JVM子进程去执行MapTask或者ReduceTask。默认一个JVM子进程只执行一个任务。在默认情况下，必然会产生JVM子进程大量的创建和销毁</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_rjk0" id="shuffle">shuffle<a href="#shuffle" class="hash-link" aria-label="shuffle的直接链接" title="shuffle的直接链接">​</a></h3>
<ul>
<li>
<p>mapper端的shuffle</p>
<ul>
<li>
<ol>
<li>map方法中context.write表示将数据写出，会将数据写出的MapTask自带的缓冲区中</li>
</ol>
</li>
</ul>
</li>
</ul>
<ol start="2">
<li>
<p>数据在缓冲区中会进行分区、排序。在缓冲区中的排序，是将完全杂乱的数据整理成有序的数据，采用了快速排序</p>
</li>
<li>
<p>每一个MapTask自带一个缓冲区，缓冲区本质上是一个环形字节数组。环形的目的是为了避免重复寻址</p>
</li>
<li>
<p>缓冲区是维系在内存中，默认容量是100M</p>
</li>
<li>
<p>当缓冲区使用达到一定限度(溢写阈值默认是0.8，即当缓冲区使用达到80%，阈值的目的是为了避免阻塞)的时候，会将缓冲区中的数据溢写(spill)到本地磁盘上，产生一个溢写文件。单个溢写文件中的数据是分好区且排好序的</p>
</li>
<li>
<p>溢写之后，后续产生的数据会继续写到缓冲区中</p>
</li>
<li>
<p>如果产生了多次溢写，每一次溢写都会产生一个新的溢写文件。所有的溢写文件之间的数据是无序的，即单个有序整体无序，这种状态称之为局部有序</p>
</li>
<li>
<p>原始数据的大小并不能决定溢写次数</p>
</li>
<li>
<p>溢写文件的大小要考虑序列化因素的影响</p>
</li>
<li>
<p>当map方法全部执行结 束之后，这个MapTask产生的所有的溢写文件会进行一次合并(merge) - 即会将多个溢写文件合并成一个最后的结果文件final out。如果溢写之后缓冲区中依然有数据并且所有的数据都已经处理完，那么缓冲区中的数据会直接溢写到最后的final out中。如果没有产生溢写，缓冲区中的数据会直接溢写到final out中</p>
</li>
<li>
<p>在merge过程中，数据会再次进行分区、排序，所以final out文件中的数据是整体分区且有序的。merge过程中的排序是将局部有序变成整体有序，采用了归并排序</p>
</li>
<li>
<h2 class="anchor anchorWithHideOnScrollNavbar_rjk0" id="如果溢写文件个数3并且指定了combiner那么在merge过程中还会自动进行combine过程">如果溢写文件个数&gt;=3，并且指定了Combiner，那么在merge过程中还会自动进行combine过程<a href="#如果溢写文件个数3并且指定了combiner那么在merge过程中还会自动进行combine过程" class="hash-link" aria-label="如果溢写文件个数&gt;=3，并且指定了Combiner，那么在merge过程中还会自动进行combine过程的直接链接" title="如果溢写文件个数&gt;=3，并且指定了Combiner，那么在merge过程中还会自动进行combine过程的直接链接">​</a></h2>
<ul>
<li></li>
</ul>
</li>
</ol>
<ul>
<li>
<p>reduce端的shuffle</p>
<ul>
<li>
<ol>
<li>ReduceTask的启动阈值是0.05，即当5%的MapTask结束之后就启动ReduceTask</li>
</ol>
</li>
</ul>
</li>
</ul>
<ol start="2">
<li>ReduceTask启动fetch线程(默认情况下是5个)去MapTask处抓取数据。fetch通过http请求方式来获取数据</li>
<li>fetch线程抓取数据的时候只抓取对应分区的数据，会将抓取来的每一段数据都存储在本地的磁盘上形成一个个的小文件</li>
<li>在抓取完数据之后，ReduceTask会将这些小文件进行merge（merge因子默认为10，即每10个文件合并成一个文件，经过多次合并最后合并成1个文件）。在merge过程中会再次进行排序。这次排序也是将局部有序整理成整体有序，所以依然采用了归并排序</li>
<li>在merge之后，会将相同的键对应的值放到一组，产生一个迭代器（这个迭代器并不是一个真正的迭代器而是一个伪迭代器，实际过程中，是产生一个流读取merge之后的文件，每次读取当前行和下一行，如果键一样，则返回当前行的值继续循环；如果键不一样，则返回当前行的值然后准备调用下一次reduce方法），这个过程称之为group(分组)</li>
</ol>
<ul>
<li>
<p>shuffle优化</p>
<ul>
<li>
<ol>
<li>增大缓冲区，一般缓冲区的大小是250~400M - 一般是SplitSize的2-3倍</li>
</ol>
</li>
</ul>
</li>
</ul>
<ol start="2">
<li>调大溢写阈值，同时也增大了阻塞的风险</li>
<li>尽量增加Combiner过程</li>
<li>可以考虑增加压缩机制，这种方案可以减少对网络资源的消耗但是Reduce收到数据之后需要解压，所以这种方案实际上是对网络资源的取舍</li>
<li>调节ReduceTask的启动阈值 - 如果集群庞大可以适当调小(尽早启动)，如果集群较小可以适当调大</li>
<li>适当增加fetch线程的数量，考虑服务器的线程承载量</li>
<li>增大ReduceTask merge因子（不建议）</li>
</ol>
<h3 class="anchor anchorWithHideOnScrollNavbar_rjk0" id="数据倾斜">数据倾斜<a href="#数据倾斜" class="hash-link" aria-label="数据倾斜的直接链接" title="数据倾斜的直接链接">​</a></h3>
<ul>
<li>
<p>Map端的数据倾斜的条件：多源输入文件不可切且文件大小不均 - 目前没有解决方案</p>
</li>
<li>
<p>实际过程中，绝大部分的倾斜是出现在Reduce端，导致Reduce端数据倾斜的直接原因是因为对数据的分类</p>
</li>
<li>
<p>针对Reduced端的数据倾斜，往往是会改变分类条件使数据趋向于均衡 - 二/两阶段聚合 - 将整个过程拆分为2个阶段，第一个阶段的目的是将数据打散之后分别  聚合，第二个阶段则是整体聚合 - 在倾斜度越大的条件下，二阶段聚合的效率就会越高</p>
</li>
<li></li>
<li>
<p>小文件处理</p>
<ul>
<li>a. 存：大量的小文件会产生大量的元数据，导致内存被大量占用。内存被大量占用就会导致NameNode的效率变低
b. 算：大量的小文件会产生大量的切片，导致产生大量的MapTask，MapTask本质上是一个线程，致使线程的调度变得格外频繁，并且线程数量过多还会导致服务器集群的卡顿甚至崩溃</li>
<li>目前市面上对于小文件的处理手段有2种：合并和打包</li>
<li>Hadoop提供了一种原生的合并手段：Hadoop Archive - 官网上的说法是对文件进行打包，达成一个har包</li>
<li>示例 hadoop archive -archiveName txt.har -p /result/ /</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_rjk0" id="hadoop架构">hadoop架构<a href="#hadoop架构" class="hash-link" aria-label="hadoop架构的直接链接" title="hadoop架构的直接链接">​</a></h2>
<h2 class="anchor anchorWithHideOnScrollNavbar_rjk0" id="yarn">yarn<a href="#yarn" class="hash-link" aria-label="yarn的直接链接" title="yarn的直接链接">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_rjk0" id="yarnyet-another-resource-negotiator---至今另一个资源协调者从hadoop20出现导致hadoop20和hadoop10是不兼容">YARN（Yet Another Resource Negotiator - 至今另一个资源协调者），从Hadoop2.0出现，导致Hadoop2.0和Hadoop1.0是不兼容<a href="#yarnyet-another-resource-negotiator---至今另一个资源协调者从hadoop20出现导致hadoop20和hadoop10是不兼容" class="hash-link" aria-label="YARN（Yet Another Resource Negotiator - 至今另一个资源协调者），从Hadoop2.0出现，导致Hadoop2.0和Hadoop1.0是不兼容的直接链接" title="YARN（Yet Another Resource Negotiator - 至今另一个资源协调者），从Hadoop2.0出现，导致Hadoop2.0和Hadoop1.0是不兼容的直接链接">​</a></h3>
<h3 class="anchor anchorWithHideOnScrollNavbar_rjk0" id="产生原因">产生原因<a href="#产生原因" class="hash-link" aria-label="产生原因的直接链接" title="产生原因的直接链接">​</a></h3>
<ul>
<li>a. 外因：随着计算框架的增多，越来越多的计算框架都基于Hadoop来进行，那么就导致不同计算框架之间的资源调度就变得比较重要。在Hadoop1.0的时候，资源调度是由各个计算框架自己完成，导致不同框架之间的资源冲突比较严重。在Hadoop2.0中，为了进行统一的资源调度，引入了YARN
b. 内因：在Hadoop1.0中，JobTracker既需要对外接收任务，又需要对内监控子任务，导致JobTracker的压力变得比较大，从而致使JobTracker成为了整个Hadoop集群的瓶颈 - 在Hadoop1.0中，官方文档中给出的数据是一个JobTracker可以最多管理4000个TaskTracker</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_rjk0" id="结构">结构<a href="#结构" class="hash-link" aria-label="结构的直接链接" title="结构的直接链接">​</a></h3>
<ul>
<li>ResourceManager：主节点。负责资源管理 - 最多2个</li>
<li>NodeManager：从节点。负责任务监控和任务计算</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_rjk0" id="job执行流程">job执行流程<a href="#job执行流程" class="hash-link" aria-label="job执行流程的直接链接" title="job执行流程的直接链接">​</a></h3>
<ul>
<li>
<ol>
<li>客户端将job提交给ResourceManager中ApplicationsManager，ApplicationsManager收到任务之后会将任务暂作存储，等待NodeManager的心跳</li>
</ol>
</li>
</ul>
<ol start="2">
<li>当ResourceManager收到心跳之后，ResourceManager中的ApplicationsManager会进行心跳响应，将job分配给NodeManager，ApplicationsManager在心跳响应中会要求NodeManager开启一个进程 - ApplicationMaster - 在YARN中，一个job就对应了一个ApplicationMaster</li>
<li>NodeManager会在本节点内部开启一个ApplicationMaster进程，将job任务分配给这个进程</li>
<li>ApplicationMaster会将job任务进行切分，将这个job切分为MapTask和ReduceTask</li>
<li>ApplicationMaster在拆分完任务之后会向ResourceManager发请求要资源，在要资源的时候，会尽量的多要。例如一个job划分为5个MapTask和1个ReduceTask，那么要的资源数就是5*3+1=16份资源</li>
<li>ResourceManager中ApplicationsManager在收到请求之后，会将这个请求转发给ResourceSchedular，ResourceSchedular会将需要的资源（内存、CPU核，注意，一份资源默认是1G内存+1CPU核）封装成Container对象返回给ApplicationsManager，然后ApplicationsManager再将Container对象返回给ApplicationMaster。ResourceManager返回的资源份数是少于要的资源数 - 要的多，给的少</li>
<li>ApplicationMaster收到Container之后，会对资源进行二次划分，划分给每一个MapTask或者ReduceTask</li>
<li>分配完成之后，ApplicationMaster就会将MapTask和ReduceTask分配到不同的NodeManager上，ApplicationMaster会监控每一个子任务的执行 - ResourceManager管理ApplicationMaster，ApplicationMaster再去管理具体的子任务</li>
<li>如果某一个子任务执行失败，那么这个子任务会释放占用的资源并且通知ApplicationMaster，ApplicationMaster收到信息之后，会再次给ResourceManager发请求重新申请资源，然后会试图重启这个子任务</li>
</ol>
<ul>
<li>
<ol start="10">
<li>ResourceSchedular：资源调度器 - 为了适应不同的资源调度策略，YARN就将ResourceSchedular设计成了一个可插拔的组件 - 资源调度策略：
a. FCFS(First come first serve) - 先到先得 - ResourceSchedular默认采用也是这种策略
b. 优先级策略 - 优先级越高，优先分配资源
c. 短任务优先 - 在任务时间差别特别明显的情况下，考虑让短任务先执行
轮询 - 时间片是轮着的</li>
</ol>
</li>
<li>
<p>执行流程图</p>
<ul>
<li></li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_rjk0" id="推测执行机制">推测执行机制<a href="#推测执行机制" class="hash-link" aria-label="推测执行机制的直接链接" title="推测执行机制的直接链接">​</a></h3>
<ul>
<li>
<ol>
<li>所谓推测执行机制是MapReduce针对慢任务提供的一种优化方案</li>
</ol>
</li>
</ul>
<ol start="2">
<li>如果出现了慢任务，MapReduce默认采取的方式是将这个慢任务复制到其他节点上，两个节点同时执行相同的任务，谁先执行完谁的结果就作为最终结果；还没有执行完的哪个任务就会被kill掉，这个过程就是推测执行机制</li>
<li>慢任务出现的场景：
a. 任务分配不均
b. 节点的硬件配置不同
c. 数据倾斜</li>
<li>在大数据场景下，因为数据具有倾斜特性，所以数据倾斜场景会更常见，此时推测执行机制对于数据倾斜是无效的，而且还会导致资源的浪费，所以会关闭推测执行机制</li>
</ol>
<h3 class="anchor anchorWithHideOnScrollNavbar_rjk0" id="uber重用">uber重用<a href="#uber重用" class="hash-link" aria-label="uber重用的直接链接" title="uber重用的直接链接">​</a></h3>
<ul>
<li>
<p>a. Resource Manager里的Applications Manager会为每一个application(比如一个用户提交的MapReduce Job)在NodeManager里面申请一个container
b. 在该container里面启动一个Application Master
c. container在Yarn中是分配资源的容器(内存、cpu核数等)，它启动时便会相应启动一个JVM
d. Application Master便陆续为application包含的每一个task(一个Map task或Reduce task)向Resource Manager申请一个container
e. 每得到一个container后，便要求该container所属的NodeManager将此container启动，然后就在这个container里面执行相应的task
f. 这个task执行完后，这个container便会被NodeManager收回，而container所拥有的JVM也相应地被退出
g.在这种情况下，可以看出每一个JVM仅会执行一Task， JVM并未被重用。</p>
</li>
<li>
<p>参数配置</p>
<ul>
<li>mapreduce.job.ubertask.enable
false
是否启用user功能。如果启用了该功能，则会将一个“小的application”的所有子task在同一个JVM里面执行，达到JVM重用的目的。这个JVM便是负责该application的ApplicationMaster所用的JVM（运行在其container里）。那具体什么样的application算是“小的application&quot;呢？下面几个参数便是用来定义何谓一个“小的application&quot;</li>
</ul>
</li>
</ul>
<p>mapreduce.job.ubertask.maxmaps
9
map任务数的阀值，如果一个application包含的map数小于该值的定义，那么该application就会被认为是一个小的application</p>
<p>mapreduce.job.ubertask.maxreduces
1
reduce任务数的阀值，如果一个application包含的reduce数小于该值的定义，那么该application就会被认为是一个小的application。不过目前Yarn不支持该值大于1的情况“CURRENTLY THE CODE CANNOT SUPPORT MORE THAN ONE REDUCE”</p>
<p>mapreduce.job.ubertask.maxbytes
application的输入大小的阀值。默认为dfs.block.size的值。当实际的输入大小部小于该值的设定，便会认为该application为一个小的application。</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/Halcyon666/summary/edit/main/docs/11-AI And BD/hadoop.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_sAp1" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_U2PO"><span class="theme-last-updated">最后<!-- -->于 <b><time datetime="2024-03-07T15:54:09.000Z">2024年3月7日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/AI And BD/flink"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">flink</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/intro"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Halcyon666 Blog</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_W1o_ thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#hadoop版本" class="table-of-contents__link toc-highlight">hadoop版本</a></li><li><a href="#hadoop模块" class="table-of-contents__link toc-highlight">hadoop模块</a><ul><li><a href="#1-hadoop-common用于支持其他模块" class="table-of-contents__link toc-highlight">1. Hadoop Common：用于支持其他模块</a></li></ul></li><li><a href="#hadoop安装" class="table-of-contents__link toc-highlight">hadoop安装</a><ul><li><a href="#单机安装及配置" class="table-of-contents__link toc-highlight">单机安装及配置</a></li><li><a href="#hadoop20和hadoop30的区别" class="table-of-contents__link toc-highlight">Hadoop2.0和Hadoop3.0的区别</a></li></ul></li><li><a href="#hdfs" class="table-of-contents__link toc-highlight">HDFS</a><ul><li><a href="#图解" class="table-of-contents__link toc-highlight">图解</a></li><li><a href="#namenode" class="table-of-contents__link toc-highlight">namenode</a></li><li><a href="#datanode" class="table-of-contents__link toc-highlight">datanode</a></li><li><a href="#secondarynamenode" class="table-of-contents__link toc-highlight">SecondaryNameNode</a></li><li><a href="#副本放置策略" class="table-of-contents__link toc-highlight">副本放置策略</a></li><li><a href="#机架感知策略" class="table-of-contents__link toc-highlight">机架感知策略</a></li><li><a href="#回收站机制" class="table-of-contents__link toc-highlight">回收站机制</a></li><li><a href="#dfs目录" class="table-of-contents__link toc-highlight">dfs目录</a></li><li><a href="#读取流程" class="table-of-contents__link toc-highlight">读取流程</a></li><li><a href="#写入流程" class="table-of-contents__link toc-highlight">写入流程</a></li><li><a href="#删除流程" class="table-of-contents__link toc-highlight">删除流程</a></li></ul></li><li><a href="#mapreduce" class="table-of-contents__link toc-highlight">MapReduce</a><ul><li><a href="#概述" class="table-of-contents__link toc-highlight">概述</a></li><li><a href="#maven-打包指定主类配置" class="table-of-contents__link toc-highlight">maven 打包指定主类配置</a></li><li><a href="#配置windowns-mapreduce运行环境" class="table-of-contents__link toc-highlight">配置windowns MapReduce运行环境</a></li><li><a href="#数据本地化策略" class="table-of-contents__link toc-highlight">数据本地化策略</a></li><li><a href="#job提交流程" class="table-of-contents__link toc-highlight">job提交流程</a></li><li><a href="#shuffle" class="table-of-contents__link toc-highlight">shuffle</a></li></ul></li><li><a href="#如果溢写文件个数3并且指定了combiner那么在merge过程中还会自动进行combine过程" class="table-of-contents__link toc-highlight">如果溢写文件个数&gt;=3，并且指定了Combiner，那么在merge过程中还会自动进行combine过程</a><ul><li><a href="#数据倾斜" class="table-of-contents__link toc-highlight">数据倾斜</a></li></ul></li><li><a href="#hadoop架构" class="table-of-contents__link toc-highlight">hadoop架构</a></li><li><a href="#yarn" class="table-of-contents__link toc-highlight">yarn</a><ul><li><a href="#yarnyet-another-resource-negotiator---至今另一个资源协调者从hadoop20出现导致hadoop20和hadoop10是不兼容" class="table-of-contents__link toc-highlight">YARN（Yet Another Resource Negotiator - 至今另一个资源协调者），从Hadoop2.0出现，导致Hadoop2.0和Hadoop1.0是不兼容</a></li><li><a href="#产生原因" class="table-of-contents__link toc-highlight">产生原因</a></li><li><a href="#结构" class="table-of-contents__link toc-highlight">结构</a></li><li><a href="#job执行流程" class="table-of-contents__link toc-highlight">job执行流程</a></li><li><a href="#推测执行机制" class="table-of-contents__link toc-highlight">推测执行机制</a></li><li><a href="#uber重用" class="table-of-contents__link toc-highlight">uber重用</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Halcyon666 Blog. Built with Docusaurus 3.1.1</div></div></div></footer></div>
</body>
</html>